/**
 * heliosRX v0.2.3
 * (c) 2020 Thomas Weustenfeld
 * @license MIT
 */
/**
 * heliosRX v0.2.3
 * (c) 2020 Thomas Weustenfeld
 * @license MIT
 */
import e from"vue";import t from"vuex";function r(e){return"[object String]"===Object.prototype.toString.call(e)}function i(e){return null!=e}function n(e){return"object"==typeof e&&null!==e}function s(e){return Array.isArray(e)}const o={database:{ServerValue:{TIMESTAMP:{".sv":"timestamp"}}},firestore:{FieldValue:{serverTimestamp(){throw new Error("Not Implemented")}}}},a=require("moment-timezone/builds/moment-timezone-with-data-2012-2022.min.js");var l;l=process.browser?window.localStorage:{getItem:()=>"Europe/Berlin",setItem(){}};const c=(e,t)=>{let r=e.clone().utc().format(),i=r.substring(0,r.length-1);return a.tz(i,t)};!function(){l.getItem("timezone"),l.getItem("timezone")||l.setItem("timezone",a.tz.guess());let e=l.getItem("timezone");a.tz.setDefault(e),a.user_timezone=e,function(e){e.isEnhanced=!0,e.prototype.isEnhanced=!0,e.fromFirestore=t=>t&&"object"==typeof t&&"Timestamp"===t.constructor.name?e(t.toDate()):e(t),e.fromRealtimeDB=t=>e.unix(t),e.fromRealtimeServerTime=t=>e(t),e.fromStore=t=>e(t),e.prototype.toFirestore=function(){return o.firestore.Timestamp.fromDate(this.toDate())},e.prototype.toRealtimeDB=function(){return this.unix()},e.prototype.toRealtimeServerTime=function(){return this.valueOf()},e.prototype.toBackend=function(e){return"REALTIMEDB"===e?this.toRealtimeDB():this.toFirestore()},e.prototype.toStore=function(){return this.format()},e.prototype.formatDateLong=function(){return this.format(this.user_dateformat)},e.prototype.isTimezoneNeutral=!1,e.fromDateAndTime=(t,r)=>{if(!r)throw new Error("Not implemented");let i=e.tz(t+"T"+r,e.user_timezone);return i.isTimezoneNeutral=!0,i},e.fromTimezoneNeutral=t=>{if(!e.isValidDate(t))return console.warn("[fromTimezoneNeutral] Invalid date",t),null;if(!t.isTimezoneNeutral)throw new Error("Input is not timezone neutral");return c(t,e.user_timezone)},e.prototype.changeTimezoneButKeepTime=function(e){return c(this,e)},e.isValidDate=function(t){return t&&e.isMoment(t)&&!!t.isEnhanced&&t.isValid()},e.currentTime=()=>{if(!e.user_timezone)throw new Error("User timezone is not set");return e().tz(e.user_timezone)},e.currentTimeUTC=()=>e().utc(),e.currentDate=()=>e().tz(e.user_timezone).startOf("day"),e.currentDateISO=()=>{e().tz(e.user_timezone).format("YYYY-MM-DD")},e.currentDateSleepCorrected=()=>e().tz(e.user_timezone).subtract(3,"hours").startOf("day"),e.currentCalendarweek=()=>e().tz(e.user_timezone).format("W"),e.currentTimeServer=e=>"REALTIMEDB"===e?o.database.ServerValue.TIMESTAMP:o.firestore.FieldValue.serverTimestamp(),e.convertHHmmToFractional=t=>(e(t,"HH:mm")-e().startOf("day"))/3600/1e3,e.convertFractionalToHHmm=t=>e.utc(3600*t*1e3).format("HH:mm"),e.parseTimeNatural=(t,r=null)=>{if(!(t=(t||"").trim()))return null;if("+"===t[0]||"-"===t[0]){let i="-"===t[0]?-1:1,n=t.slice(1);/[mhs]/i.test(n)||(n+="m");let s=null;if(!s.match)return null;let o=i*s.duration;return e(r,"HH:mm").add(o,"seconds")}return"now"===t?e():e(t,["HH:mm","HH:mm A","HH A","HH"])},process.browser&&(window.moment=e)}(a)}();const u={CUSTOM:1,SLUGID:2,PUSHID:3,TIMESTAMP:4,LOCAL_TIMESTAMP:5,DATE:6,OTHER_USER_ID:7,MY_USER_ID:8,ARRAY:9,EMAIL:10},d={SOFT:0,HARD:1};function h(e,t,r){return e.replace(/\{.+?}/g,e=>function(e,t,r=`{${e}}`){return e.split(".").reduce((e,t)=>e[t]||r,t)}(e.substr(1,e.length-2).trim(),t,r))}function f(e){return(e.match(/\{.+?}/g)||[]).map(e=>e.slice(1,-1))}let _,m,p=e,y=t,b={},g={};function v(e){e.Vue&&(p=e.Vue),e.Vuex&&(y=e.Vuex),e.Firebase&&(_=e.Firebase),e.registry&&(m=e.registry),e.models&&(b=e.models),e.db&&(g=e.db)}function w(){return m}var j={configure({GenericList:GenericList,GenericModel:GenericModel}){this.GenericList=GenericList,this.GenericModel=GenericModel},make_reactive_list(e,t,r,i=!1){let n=r.model.name,s=new this.GenericList(n);if(t){for(let i in t){let n=this.make_reactive_model(e,t[i],r);n.$id=i,n._update_data(t[i],e.schema.fields),s._add_child(i,n)}s.$readyAll=!0,s.$numReady=Object.keys(t).length}return e.listActions&&s._decorate_actions(e.listActions,r),!e.listGetters||i||e.no_reactive_getters||s._decorate_getters(e.listGetters,r),p.observable(s),s},make_reactive_model(e,t,r,i=!1,n=!1){let s=r.model.name,o=new this.GenericModel(null,null,s);return o._set_generic_store(r.model),e.schema&&e.schema.fields?o._autogenerate_props(e.schema.fields,t,i):console.warn("Making a reactive model without schema. This means props are not autogenerated and only accessible through model.$state. Please provide a schema for "+s+"."),t&&(o._update_data(t,e.schema.fields),o.$ready=!0),e.modelActions&&o._decorate_actions(e.modelActions,r),!e.modelGetters||n||e.no_reactive_getters||o._decorate_getters(e.modelGetters,r),p.observable(o),o}},E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function A(e,t){return e(t={exports:{}},t.exports),t.exports}var $=A((function(e,t){var r="[object Arguments]",i="[object Function]",n="[object GeneratorFunction]",s="[object Map]",o="[object Set]",a=/\w*$/,l=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,u={};u[r]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object DataView]"]=u["[object Boolean]"]=u["[object Date]"]=u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u[s]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u[o]=u["[object String]"]=u["[object Symbol]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Error]"]=u[i]=u["[object WeakMap]"]=!1;var d="object"==typeof E&&E&&E.Object===Object&&E,h="object"==typeof self&&self&&self.Object===Object&&self,f=d||h||Function("return this")(),_=t&&!t.nodeType&&t,m=_&&e&&!e.nodeType&&e,p=m&&m.exports===_;function y(e,t){return e.set(t[0],t[1]),e}function b(e,t){return e.add(t),e}function g(e,t,r,i){var n=-1,s=e?e.length:0;for(i&&s&&(r=e[++n]);++n<s;)r=t(r,e[n],n,e);return r}function v(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function w(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function j(e,t){return function(r){return e(t(r))}}function A(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var $,S=Array.prototype,O=Function.prototype,D=Object.prototype,R=f["__core-js_shared__"],x=($=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"",T=O.toString,I=D.hasOwnProperty,k=D.toString,M=RegExp("^"+T.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=p?f.Buffer:void 0,P=f.Symbol,G=f.Uint8Array,U=j(Object.getPrototypeOf,Object),L=Object.create,z=D.propertyIsEnumerable,F=S.splice,V=Object.getOwnPropertySymbols,B=N?N.isBuffer:void 0,C=j(Object.keys,Object),q=pe(f,"DataView"),Y=pe(f,"Map"),W=pe(f,"Promise"),H=pe(f,"Set"),X=pe(f,"WeakMap"),K=pe(Object,"create"),Q=we(q),J=we(Y),Z=we(W),ee=we(H),te=we(X),re=P?P.prototype:void 0,ie=re?re.valueOf:void 0;function ne(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function se(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function oe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ae(e){this.__data__=new se(e)}function le(e,t){var i=Ee(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ae(e)}(e)&&I.call(e,"callee")&&(!z.call(e,"callee")||k.call(e)==r)}(e)?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],n=i.length,s=!!n;for(var o in e)!t&&!I.call(e,o)||s&&("length"==o||ge(o,n))||i.push(o);return i}function ce(e,t,r){var i=e[t];I.call(e,t)&&je(i,r)&&(void 0!==r||t in e)||(e[t]=r)}function ue(e,t){for(var r=e.length;r--;)if(je(e[r][0],t))return r;return-1}function de(e,t,l,c,d,h,f){var _;if(c&&(_=h?c(e,d,h,f):c(e)),void 0!==_)return _;if(!Oe(e))return e;var m=Ee(e);if(m){if(_=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&I.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!t)return function(e,t){var r=-1,i=e.length;t||(t=Array(i));for(;++r<i;)t[r]=e[r];return t}(e,_)}else{var p=be(e),j=p==i||p==n;if($e(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if("[object Object]"==p||p==r||j&&!h){if(v(e))return h?e:{};if(_=function(e){return"function"!=typeof e.constructor||ve(e)?{}:function(e){return Oe(e)?L(e):{}}(U(e))}(j?{}:e),!t)return function(e,t){return _e(e,ye(e),t)}(e,function(e,t){return e&&_e(t,De(t),e)}(_,e))}else{if(!u[p])return h?e:{};_=function(e,t,r,i){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return fe(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return function(e,t){var r=t?fe(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?fe(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,i);case s:return function(e,t,r){return g(t?r(w(e),!0):w(e),y,new e.constructor)}(e,i,r);case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,a.exec(e));return t.lastIndex=e.lastIndex,t}(e);case o:return function(e,t,r){return g(t?r(A(e),!0):A(e),b,new e.constructor)}(e,i,r);case"[object Symbol]":return l=e,ie?Object(ie.call(l)):{}}var l}(e,p,de,t)}}f||(f=new ae);var E=f.get(e);if(E)return E;if(f.set(e,_),!m)var $=l?function(e){return function(e,t,r){var i=t(e);return Ee(e)?i:function(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}(i,r(e))}(e,De,ye)}(e):De(e);return function(e,t){for(var r=-1,i=e?e.length:0;++r<i&&!1!==t(e[r],r,e););}($||e,(function(r,i){$&&(r=e[i=r]),ce(_,i,de(r,t,l,c,i,e,f))})),_}function he(e){return!(!Oe(e)||(t=e,x&&x in t))&&(Se(e)||v(e)?M:l).test(we(e));var t}function fe(e){var t=new e.constructor(e.byteLength);return new G(t).set(new G(e)),t}function _e(e,t,r,i){r||(r={});for(var n=-1,s=t.length;++n<s;){var o=t[n],a=i?i(r[o],e[o],o,r,e):void 0;ce(r,o,void 0===a?e[o]:a)}return r}function me(e,t){var r,i,n=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function pe(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return he(r)?r:void 0}ne.prototype.clear=function(){this.__data__=K?K(null):{}},ne.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ne.prototype.get=function(e){var t=this.__data__;if(K){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return I.call(t,e)?t[e]:void 0},ne.prototype.has=function(e){var t=this.__data__;return K?void 0!==t[e]:I.call(t,e)},ne.prototype.set=function(e,t){return this.__data__[e]=K&&void 0===t?"__lodash_hash_undefined__":t,this},se.prototype.clear=function(){this.__data__=[]},se.prototype.delete=function(e){var t=this.__data__,r=ue(t,e);return!(r<0)&&(r==t.length-1?t.pop():F.call(t,r,1),!0)},se.prototype.get=function(e){var t=this.__data__,r=ue(t,e);return r<0?void 0:t[r][1]},se.prototype.has=function(e){return ue(this.__data__,e)>-1},se.prototype.set=function(e,t){var r=this.__data__,i=ue(r,e);return i<0?r.push([e,t]):r[i][1]=t,this},oe.prototype.clear=function(){this.__data__={hash:new ne,map:new(Y||se),string:new ne}},oe.prototype.delete=function(e){return me(this,e).delete(e)},oe.prototype.get=function(e){return me(this,e).get(e)},oe.prototype.has=function(e){return me(this,e).has(e)},oe.prototype.set=function(e,t){return me(this,e).set(e,t),this},ae.prototype.clear=function(){this.__data__=new se},ae.prototype.delete=function(e){return this.__data__.delete(e)},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var r=this.__data__;if(r instanceof se){var i=r.__data__;if(!Y||i.length<199)return i.push([e,t]),this;r=this.__data__=new oe(i)}return r.set(e,t),this};var ye=V?j(V,Object):function(){return[]},be=function(e){return k.call(e)};function ge(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function ve(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||D)}function we(e){if(null!=e){try{return T.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function je(e,t){return e===t||e!=e&&t!=t}(q&&"[object DataView]"!=be(new q(new ArrayBuffer(1)))||Y&&be(new Y)!=s||W&&"[object Promise]"!=be(W.resolve())||H&&be(new H)!=o||X&&"[object WeakMap]"!=be(new X))&&(be=function(e){var t=k.call(e),r="[object Object]"==t?e.constructor:void 0,i=r?we(r):void 0;if(i)switch(i){case Q:return"[object DataView]";case J:return s;case Z:return"[object Promise]";case ee:return o;case te:return"[object WeakMap]"}return t});var Ee=Array.isArray;function Ae(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Se(e)}var $e=B||function(){return!1};function Se(e){var t=Oe(e)?k.call(e):"";return t==i||t==n}function Oe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function De(e){return Ae(e)?le(e):function(e){if(!ve(e))return C(e);var t=[];for(var r in Object(e))I.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return de(e,!0,!0)}}));function S(e,t,r){t.getters?console.warn("Name conflict: property getters already exists"):t.getters={};const i={};for(let s in r){let o=r[s];i[s]=()=>o.apply(t,e),Object.defineProperty(t.getters,s,{get:()=>n[s],enumerable:!0})}const n=new p({computed:i});return n}function O(e,t,r,i){for(let n in r){let s=r[n];if(i&&delete t[n],Object.prototype.hasOwnProperty.call(t,n)){let t=e.$model.name;console.warn(`Name conflict: action "${n}" has same name as another method or property "${n}" in ${t}`)}else Object.defineProperty(t,n,{value:(...r)=>(e.$modelsGetter&&(e.$models=e.$modelsGetter()),s.apply(t,[e,...r])),enumerable:!0})}}function D(e){return e&&"object"==typeof e&&!Array.isArray(e)}function R(e,t){return t.split(".").reduce((e,t)=>e[t]||{},e)}function x(e,t){const r=(""+t).split("."),i=r.pop();return r.reduce((e,t)=>e[t]||{},e)[i]}function T(e,t,r=!0){let i=r?Object.assign({},e):{};for(let n in t){let s=null,o=null;e&&(s=D(e[n])),t&&(o=D(t[n])),s&&o?T(e[n],t[n],r):p.set(e,n,t[n]),delete i[n]}for(let t in i)p.delete(e,t);return i}function I(e,t,r){const i=(""+t).split("."),n=i.pop(),s=i.reduce((e,t)=>(t in e||p.set(e,t,{}),e[t]),e);if(n in s){if(".value"in r&&null===r[".value"])return void p.delete(s,n);T(s[n],r,!0)}else p.set(s,n,r);return s[n]}const k=new WeakMap,M=new WeakMap,N=["ServerTimestamp","CurrentTimestamp","InitialTimestamp"];class GenericModel{constructor(e,t,r){this.$ready=!1,this.$promise=Promise.resolve(),this.$state={},this.$dirty={},this.$invalid={},this.$id=null,this.$idx=null,this.$noaccess=null,this._store_name=r,p.observable(this.$state)}_update_data(e,t,r=!1){if(this.$state=e,r)for(var i in e)this.$dirty[i]=!0}clone(){const e=Object.assign(Object.create(Object.getPrototypeOf(this)),this);return e.$state=$(e.$state),e.$dirty=$(e.$dirty),e.$invalid=$(e.$invalid),e._autogenerate_props(this.$model.modelDefinition.schema.fields,e.$state,!1),e._set_generic_store(this.$model),k.set(e,this.$vm),e}setValidationBehaviour(e){["ERROR","WARNING","ELEMENT_VALIDATION","NONE"].includes(e)&&(this._validation_behaviour=e)}_update_field(e,t,r){let i=this._validation_behaviour||"WARNING";const n=r.is_nested?()=>function(e,t,r){const i=(""+t).split("."),n=i.pop(),s=i.reduce((e,t)=>(t in e||p.set(e,t,{}),e[t]),e);return p.set(s,n,r),s[n]}(this.$state,e,t):()=>p.set(this.$state,e,t);if(a.isMoment(t))return a.isValidDate(t)||console.warn("Got invalid e-moment object",t,"for prop",e),t=t.toRealtimeDB(),delete this.$invalid[e],this.$dirty[e]=!0,void n();if(!r.validator)return n(),void(this.$dirty[e]=!0);if(r.validator(t))delete this.$invalid[e],this.$dirty[e]=!0,n();else{if(this.$invalid[e]=!0,this.$dirty[e]=!0,n(),"ERROR"===i)throw new Error(`Validation failed for field '${e}' with value ${t}.`);"WARNING"===i&&console.warn(`Validation failed for field '${e}' with value ${t}.`)}}_on_remove(){this.$deleted=!0}get $isValid(){return 0===Object.keys(this.$invalid).length}get $key(){return"KEY-"+this._store_name+"-"+this.$id}get $vm(){return k.get(this)}get $model(){return M.get(this)}get $exists(){return!1!==this.$state[".exists"]}_autogenerate_props(e,t,r=!1){Array.isArray(e)||(e=Object.keys(e).map(t=>({model:t,...e[t]}))),e.forEach(e=>{let i=e.model;if(t&&i in t&&(this.$state[i]=t[i]),r&&(this.$dirty[i]=!0),Object.prototype.hasOwnProperty.call(this,i))return void console.warn(`Name conflict: property "${i}" has same name as global action/global getter "${i}" in ${this._store_name}`);let n=()=>{},s="";if(i.includes("/")||i.includes(".")){s=i.replace(/\//g,".");let t=s.split("."),r=t.pop();t=t.join("."),n=()=>R(this.$state,t)[r],e.is_nested=!0}else s=i,n=()=>this.$state[i],e.is_nested=!1;if(e.type){const t=(e,t,r,n)=>0===e||null===e?e:a.isMoment(e)?void console.error("Do not assign moment objects directly."):isFinite(e)&&e>r&&e<n?t(e):void 0===e?t():(console.warn("Schema defined",i,"as Timestamp, but got invalid data:",e),e);let r=n;"Timestamp"===e.type?n=()=>t(r(),a.fromRealtimeDB,2e8,3e10):N.includes(e.type)?n=()=>t(r(),a.fromRealtimeServerTime,2e11,3e13):e.type.includes("Timestamp")&&console.warn("Found validation type that contains 'Timestamp' but is not recognized:",e.type)}Object.defineProperty(this,s,{set:t=>this._update_field(s,t,e),get:n})})}_decorate_actions(e,t){if(!e)return;O({$instance:this,$model:t.model,$models:t.models},this,e,!1)}_decorate_getters(e,t){if(!e)return;for(let t in e)Object.prototype.hasOwnProperty.call(this,t)&&(console.warn(`Name conflict: getter "${t}" has same name as property/custom action/global action/global getter "${t}" in ${this._store_name}`),delete e[t]);let r=S([this,t.model,t.models],this,e);k.set(this,r)}_set_generic_store(e){M.set(this,e)}write(){console.log("Writing $dirty fields",JSON.stringify(this.$dirty));let e={};for(let t in this.$dirty){let r,i;t.includes(".")?(i=t.replace(/\./g,"/"),r=x(this.$state,t)):(i=t,r=this.$state[t]),void 0!==r?e[i]=r:console.warn("Trying to write undefined for prop",t)}let t=this.$model;if(!t)throw new Error("Model reference not set with _set_generic_store");let r=!0,i=this.$id;return i||(i=t._get_uid(),r=!1),t.modelDefinition&&t.modelDefinition.schema?t._validate_schema(e,r):console.warn("No schema found to validate input"),t.update(i,e).then(()=>(this.$id=i,this.$dirty={},i))}_get_model_for_write(){if(!this.$id)throw new Error("Write operations are not allowed for new models.");let e=this.$model;if(!e)throw new Error("Model reference not set with _set_generic_store");return e}update(e){return this._get_model_for_write().update(this.$id,e).then(()=>{for(var t in e)delete this.$dirty[t];return this.$id})}remove(e=!0){return this._get_model_for_write().remove(this.$id,e).then(()=>{e&&delete this.$dirty.deleted})}restore(){return this._get_model_for_write().restore(this.$id).then(()=>{delete this.$dirty.deleted})}reset(){}}function P(e,t){return e.sortidx<t.sortidx?-1:e.sortidx>t.sortidx?1:0}function G(e){let t=null;return"-"===e[0]?(e=e.slice(1),t=(t,r)=>t[e]<r[e]?1:t[e]>r[e]?-1:0):t=(t,r)=>t[e]<r[e]?-1:t[e]>r[e]?1:0,t}const U=new WeakMap;class GenericList{constructor(e){this.items={},this.$readyAll=!1,this.$readySome=!1,this.$promise=Promise.resolve(),this.$numReady=0,this.$noaccess=null,this.$numChildren=0,this._store_name=e,this._unwatch=null}_clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}_add_child(e,t){this.$readySome=!0,this.$lastUpdate=Date.now(),p.set(this.items,e,t),this.$numChildren+=1,this.items[e].$idx=this.$numChildren}_rem_child(e){e in this.items&&this.items[e]._on_remove(),p.delete(this.items,e),this.$numChildren-=1}get $vm(){return U.get(this)}_decorate_actions(e,t){if(!e)return;O({$instance:this,$model:t.model,$models:t.models},this,e,!1)}_decorate_getters(e,t){if(!e)return;for(let t in e)Object.prototype.hasOwnProperty.call(this,t)&&(console.warn(`Name conflict: list getter "${t}" has same name as existing property getter "${t}" in ${this._store_name}`),delete e[t]);let r=S([this,t.model,t.models],this,e);U.set(this,r)}getItemByIdx(e){for(let t in this.items)if(this.items[t].$idx===e)return this.items[t];return null}asArraySorted(){let e=this._clone();return e.items=this.itemsAsArray(),e.items.sort(P),e}asArraySortedBy(e){let t=this._clone();return t.items=this.itemsAsArray(),t.items.sort(G(e)),t}asArrayFilteredBy(e,t){let r=this._clone();return r.items=this.itemsAsArray(),r.items=r.items.filter(r=>r[e]===t),r}itemsAsArray(){return Array.isArray(this.items)?this.items:Object.keys(this.items).map(e=>this.items[e])}get itemsSorted(){return this.itemsAsArray().sort(P)}itemsAsArrayWithoutDeleted(e){return this.itemsAsArray().filter(e=>!1===e.deleted||void 0===e.deleted).sort(e?G(e):P)}itemsAsArrayOnlyDeleted(e){return this.itemsAsArray().filter(e=>!0===e.deleted).sort(e?G(e):P)}get $idList(){return Object.keys(this.items)}reset(){this._unwatch&&(console.log("Found local unwatcher in",this._store_name),this._unwatch())}}function L(e){var t=e[e.length-1];return e.pop(),e=e.length>1?L(e):e[0],function(...r){var i=e(...r),n=t(...r);return Object.assign(i||{},n)}}function z(){var e,t,r=new Promise((r,i)=>{e=r,t=i});return r.resolve=e,r.reject=t,r}let F=Array.prototype;function V(e,t){return e.filter(e=>t.indexOf(e)<0)}Object.defineProperty(F,"clone",{value:function(){return this.slice(0)},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(F,"move",{value:function(e,t){this.splice(t,0,this.splice(e,1)[0])},enumerable:!1,configurable:!0,writable:!0});const B=()=>{},C=B,q=B,Y=B,W=B,H=B,X=new WeakMap,K=new Map,Q=new Map,J=new Map;"false"===String(process.env.VUE_APP_PRODUCTION)&&(window.helioRxDev=window.helioRxDev||{},window.helioRxDev._resultInstanceCache=Q,window.helioRxDev._resultListCache=J,window.helioRxDev._autoUnsubscribeMap=K);var Z={_read_mixin_init(){if(Y(this.name),this.modelDefinition&&this.modelDefinition.staticGetters){const e=[this,b];this._vm=S(e,this,this.modelDefinition.staticGetters)}},get subscriptions(){return X.get(this)},_bind_rtdb({key:e,ref:t,ops:r,bindAsArray:i}){let n=this._last_caller||null;if(this.autoUnsubscribe&&n){let t=()=>(this._unbind_rtdb(e),{[e]:!0}),r=K.get(n.uid);r&&(t=L([t,r])),K.set(n._uid,t),n.$once("hook:beforeDestroy",()=>{this._clean_up_refs(n)})}let s=X.get(this);return s||(s=Object.create(null),X.set(this,s)),e in s&&this._unbind_rtdb(e),new Promise((n,o)=>{s[e]=i?function({collection:e,ops:t,resolve:r,reject:i}){const{target:n}=t.init();e.once("value",e=>{t.once(n,e.val(),e.exists()),r()},e=>{e&&i(e)});const s=e.on("child_added",(e,r)=>{t.add(n,e.key,e.val())},i),o=e.on("child_removed",e=>{t.remove(n,e.key)},i),a=e.on("child_changed",e=>{t.set(n,e.key,e.val())},i),l=e.on("child_moved",(e,t)=>{},i);return()=>{e.off("child_added",s),e.off("child_changed",a),e.off("child_removed",o),e.off("child_moved",l)}}({key:e,collection:t,ops:r,resolve:n,reject:o}):function({document:e,ops:t,resolve:r,reject:i}){const{target:n}=t.init(),s=e.on("value",e=>{let i=e.val();e.exists()||(i={".exists":!1}),t.set(n,i),r(i)},e=>{e&&i(e)});return()=>{e.off("value",s)}}({key:e,document:t,ops:r,resolve:n,reject:o})})},_clean_up_refs(e){let t=K.get(e._uid),r=e.$options.name||e.$options._componentTag;if(t){let i=t();console.log(`%cIt seems that the VueComponent "${r}" (${e.$vnode.tag}), \n`+"accessed this.$models and created a subscriptions. The components \n"+`just got destroyed and so did it's subscription to ${JSON.stringify(Object.keys(i))}.`,"color: green")}else console.log(`%cIt seems that the VueComponent "${r}" (${e.$vnode.tag}), \n`+"accessed this.$models, but it either didn't create any subscriptions or \nthe subscription was already removed. The component just got destroyed \nso there is nothing to clean up.","color: darkgoldenrod");K.delete(e._uid)},_fetch_rtdb:({key:e,ref:t,ops:r,bindAsArray:i})=>new Promise((n,s)=>{i?function({collection:e,ops:t,resolve:r,reject:i}){const{target:n}=t.init();e.once("value",e=>{let i=e.val();t.once(n,i,e.exists()),r(i)},e=>{e&&i(e)})}({key:e,collection:t,ops:r,resolve:n,reject:s}):function({document:e,ops:t,resolve:r,reject:i}){const{target:n}=t.init();e.once("value",e=>{let i=e.val();e.exists()||(i={".exists":!1}),t.set(n,i),r(i)},e=>{e&&i(e)})}({key:e,document:t,ops:r,resolve:n,reject:s})}),_unbind_rtdb({key:e}){const t=X.get(this);t&&t[e]&&(t[e](),delete t[e])},_infer_local_path_from_ref:e=>e.path.toString().split("/").filter(e=>e).join("."),unsync(e=null,{clean_up:t=!1}={}){Y(this.name);let r=null!==e?this.global_store_path_array[e]:this.global_store_path;if(r&&this._unbind_rtdb({key:r}),null!==e&&!(e in this.global_store_path_array)){if(this.isSuffixed)throw new Error("Unsync with id for data retrieved via subscribeList() is not supported.");r=this.global_store_path+"."+e}if(t){if(H(this.name),null!==e&&J.has(this.path)){J.get(this.path)._rem_child(e)}m.commit("heliosrx/UNSET_VALUE",{path:r},{root:!0})}},unsyncAll({clean_up:e=!1}={}){if(Y(this.name),X){if(e&&J.has(this.path)){let e=J.get(this.path);e.$idList.forEach(t=>e._rem_child(t)),e.reset()}Object.keys(X).forEach(t=>{this._unbind_rtdb({key:t}),e&&m.commit("heliosrx/UNSET_VALUE",{path:t},{root:!0})})}},_fetch_individual(e,{overwriteKey:t=!1,customOps:r={}}={}){return this._sync_individual(e,{overwriteKey:t,customOps:r,fetchOnce:!0})},_fetch_list({overwriteKey:e=!1,customOps:t={},customRef:r=null}={}){return this._sync_list({overwriteKey:e,customOps:t,customRef:r,fetchOnce:!0})},_sync_individual(e,{overwriteKey:t=!1,fetchOnce:r=!1,customOps:i={}}={}){this.isSuffixed;const n=this.childRef(e),s="res."+this._infer_local_path_from_ref(n);this.global_store_path_array[e]=s,q(this.name,"_sync_individual:",this.name),Y(this.name,"[GENS] - sync ref",n.path.toString()),Y(this.name),Y(this.name,"[GENS] - sync target",this.global_store_path_array[e]);let o={init:()=>{let t={};return Y(this.name),m.commit("heliosrx/INIT_VALUE",{path:this.global_store_path_array[e],data:t},{root:!0}),{target:t}},set:(e,t)=>{Y(this.name),m.commit("heliosrx/SET",{target:e,data:t},{root:!0})}};return r&&(o={init:()=>{W(this.name);return{target:{}}},set:(e,t)=>{W(this.name)}}),Object.keys(i).forEach(e=>{o[e]=L([o[e],i[e]])}),r?this._fetch_rtdb({key:s,ref:n,ops:o,bindAsArray:!1}):this._bind_rtdb({key:s,ref:n,ops:o,bindAsArray:!1})},_sync_list({overwriteKey:e=!1,fetchOnce:t=!1,customOps:r={},customRef:i=null}={}){if(this.isSuffixed)throw new Error("Suffixed store does not support bind to array");const n=i||this.parentRef,s="res."+(e||this._infer_local_path_from_ref(n));q(this.name,"sync:",this.name),Y(this.name,"[GENS] - ref",this.parentRef),Y(this.name),this.global_store_path=s;const o={root:!0};let a={init:()=>{Y(this.name,"[OPS:INIT]",this.global_store_path,m.state);let e={},t=R(m.state,this.global_store_path);return Object.keys(t).length>0&&(Y(this.name),e=t),Y(this.name),m.commit("heliosrx/INIT_VALUE",{path:this.global_store_path,data:e},o),{target:e}},add:(e,t,r)=>{Y(this.name),m.commit("heliosrx/ARRAY_ADD",{target:e,newId:t,data:r},o)},remove:(e,t)=>{let r=e[t],i=this._match_all_existing_synced_queries(this.path);H(this.name),H(this.name,"entry_name",this.path),H(this.name),H(this.name);for(let e in i){let t=i[e].query;if(this._item_matches_query(t,r))return void H(this.name)}m.commit("heliosrx/ARRAY_REMOVE",{target:e,oldId:t},o)},set:(e,t,r)=>{Y(this.name),m.commit("heliosrx/ARRAY_SET",{target:e,currentId:t,data:r},o)},once:(e,t,r)=>{}};return t&&(a={init:()=>{W(this.name);return{target:{}}},once:(e,t,r)=>{W(this.name)}}),Object.keys(r).forEach(e=>{a[e]=L([a[e],r[e]])}),Y(this.name),Y(this.name),t?this._fetch_rtdb({key:s,ref:n,ops:a,bindAsArray:!0}):this._bind_rtdb({key:s,ref:n,ops:a,bindAsArray:!0})},_item_matches_query:(e,t)=>!0,_create_context(){return{model:this,models:b}},_match_all_existing_synced_queries(e,t=!0){e.includes("#")&&(e=e.split("#").shift());let r=[];for(var i in m.state.sync){let n=i.split("#").shift();if(e.startsWith(n)){let e=m.state.sync[i];if(!t||"Ready"!==e.status&&"Loading"!==e.status)continue;r.push({path:i,path_without_query:n,...e})}}return r},_match_existing_synced_nodes(e,t=!1){for(var r in e.includes("#")&&(e=e.split("#").shift()),m.state.sync){let i=r;if(r.includes("#")){let t=r.split("#").shift();e.startsWith(t)&&console.warn("You're trying to sync a path that has already been synced by a query. This is not supported.","requested_path",e,"existing_path",r)}if(t&&r.includes("{id}")&&(r=r.replace("{id}","")),e.startsWith(r)&&("Ready"===m.state.sync[i].status||"Loading"===m.state.sync[i].status))return q(this.name),i}return!1},_get_sync_state:e=>(m.state.sync[e]||{}).status||null,getList(e,{noReactiveGetter:t=!1}={}){return q(this.name),this.subscribeList(e,{noSync:!0,createModelFromExistingCache:!0,noReactiveGetter:t})},getNode(e,{noReactiveGetter:t=!1}={}){if(q(this.name),!e)throw new Error("getNode: got invalid id: "+e);return this.subscribeNode(e,{noSync:!0,createModelFromExistingCache:!0,noReactiveGetter:t})},subscribeList(e=[],{noSync:t=!1,noReactiveGetter:r=!1,createModelFromExistingCache:i=!1,queryParams:n=null}={}){let s=null,o="",a=this.path;if(n&&(s=this.buildQueryRef(n),o=this._query_hash(n),a=a+"#"+o,C(this.name)),q(this.name),J.get(a))return q(this.name),J.get(a);let l=m.getters.get_registry_entry(a);l&&q(this.name);const c=this._match_existing_synced_nodes(a,!0);if(c){if(i){let e=this.getData();q(this.name);let t=j.make_reactive_list(this.modelDefinition,e,this._create_context(),r);t.$promise=z();let i=this._get_sync_state(c);q(this.name),"Ready"===i&&t.$promise.resolve(!0),H(this.name);let n=m.watch(e=>(H(this.name),this.getData(null,!0)),(e,i)=>{if(H(this.name),null==e)return t.$idList.forEach(e=>{H(this.name),t._rem_child(e)}),t.$numReady=!1,t.$readyAll=!1,t.$readySome=!1,void t.$promise.resolve(!0);let n=Object.keys(e),s=i?Object.keys(i):[],o=t.$idList;n.toString()===s.toString()&&H(this.name);let l={removed:V(u=o,c=n),added:V(c,u)};var c,u;H(this.name),l.removed.forEach(e=>{H(this.name),t._rem_child(e),t.$numReady--}),l.added.forEach(e=>{H(this.name);let i=a.split("#").shift().replace(/\{id\}/g,e);Q.has(i)&&console.warn("A new item was added, but there already exists a model instance in the cache for this item. This means the subscription management failed.");let n=this.getData(e),s=j.make_reactive_model(this.modelDefinition,n,this._create_context(),!1,r);s.$id=e,t._add_child(e,s),t.$numReady++,Q.set(i,s)}),t.$promise.resolve(!0)});return t._unwatch=n,J.set(a,t),t}console.warn("You're trying to sync data, that is already synced by a node higher up in the hierarchy. This will result in undefined behaviour. Try using getList() or getNode() instead! Sync path:",a)}if(this._match_existing_synced_nodes(a)===a)throw console.log(">>>",a,J,Q),new Error("Exact path found, but no cache hit. This should never happen");if(t)return q(this.name),console.warn("You're trying to fetch data at "+a+" that has not been synced yet."),null;C(this.name),l={query:n,status:"Loading"},m.commit("ADD_ENTRY",{name:a,data:l});let u=j.make_reactive_list(this.modelDefinition,null,this._create_context());J.set(a,u),u.$promise=z(),q(this.name);const d={add:(e,t,i)=>{m.commit("SET_ENTRY_STATUS",{name:a,value:"Ready"}),q(this.name,"subscribeList:add - Child ready",this.name);let n=a.split("#").shift().replace(/\{id\}/g,t);Q.has(n)&&q(this.name),t in u.items&&console.warn("An existing item was added twice. This means the subscription management failed.");let s=Q.has(n)?Q.get(n):j.make_reactive_model(this.modelDefinition,i,this._create_context(),!1,r);s.$id=t,u._add_child(t,s),Q.has(n)?s._update_data(i):Q.set(n,s)},init:()=>(q(this.name),{}),remove:(e,t)=>{H(this.name),u._rem_child(t)},set:(e,t,r)=>{if(q(this.name),J.get(a)&&t in J.get(a).items){let e=J.get(a).items[t],r=this.getData(t);e._update_data(r,this.modelDefinition.schema.fields),q(this.name)}else q(this.name,"subscribeList:set - WARNING - not found in cache!",t,J.get(a))}};return this._sync_list({customOps:d,customRef:s}).then(()=>{u.$readyAll=!0,u.$promise.resolve(!0)}).catch(e=>{if("PERMISSION_DENIED"!==e.code)throw e;console.warn(e.message),console.log("======================================"),console.log(`PERMISSION_DENIED [${this.name}.subscribeList()]`),console.log("queryParams:",n),console.log("======================================"),u.$readyAll=!0,u.$readySome=!0,u.$noaccess=!0,u.$promise.reject(e)}),u},subscribeNode(e,{noSync:t=!1,noReactiveGetter:r=!1,createModelFromExistingCache:i=!1}={}){if(!e)throw new Error("subscribeNode: got invalid id: ");let n=this.previewPath(e),s=this.path;if(q(this.name),J.get(s)&&e in J.get(s).items)return q(this.name),J.get(s).items[e];if(Q.has(n))return q(this.name),Q.get(n);if(this._match_existing_synced_nodes(s)&&C(this.name,"======================================= (FIXME)",{entry_name_child:n},{entry_name_list:s},{"has:node":Q.has(n)},{"get:list":Q.get(s)}),this._match_existing_synced_nodes(n)){if(i){let t=this.getData(e);q(this.name);let i=j.make_reactive_model(this.modelDefinition,t,this._create_context(),!1,r);return i.$id=e,i.$ready=!0,Q.set(n,i),q(this.name),i}console.warn("You're trying to sync data, that is already synced by a node higher up in the hierarchy. This will result in undefined behaviour. Try using getNode() instead! Sync path:",n)}if(this._match_existing_synced_nodes(n)===n)throw console.log(">>>",n,J,Q),new Error("Exact path found, but no cache hit. This should never happen");if(t)return null;C(this.name);let o=j.make_reactive_model(this.modelDefinition,null,this._create_context(),!1,r);o.$id=e,o.$promise=z(),Q.set(n,o);let a={id:e,status:"Loading"};m.commit("ADD_ENTRY",{name:n,data:a}),q(this.name);const l={init:e=>(q(this.name),{}),set:(e,t)=>{q(this.name)}};return this._sync_individual(e,{customOps:l}).then(t=>{let r=this.getData(e);q(this.name),void 0!==r?(o._update_data(r,this.modelDefinition.schema.fields),o.$ready=!0,o.$noaccess=!1,m.commit("SET_ENTRY_STATUS",{name:n,value:"Ready"}),q(this.name),o.$promise.resolve(!0)):console.warn(this.name,"subscribeNode - subscribeList took over, while waiting for _sync_individual. subscribeList will handle instance now.")}).catch(t=>{if("PERMISSION_DENIED"!==t.code)throw t;{console.warn(t.message),console.log("======================================"),console.log(`PERMISSION_DENIED [${this.name}.subscribeNode( ${e} )]`),console.log("======================================"),m.commit("SET_ENTRY_STATUS",{name:n,value:"NoAccess"});let r=this.getData(e);r[".noaccess"]=!0,o._update_data(r,this.modelDefinition.schema.fields),o.$ready=!0,o.$noaccess=!0,o.$promise.reject(t)}}),o},buildQueryRef({key:e,value:t,limit:r,startAt:i,endAt:n}){let s=this.parentRef;return s="*"===e?s.orderByValue():void 0===e?s.orderByKey():s.orderByChild(e),void 0!==t&&(s=s.equalTo(t)),void 0!==i&&(s=s.startAt(i)),void 0!==n&&(s=s.endAt(n)),void 0!==r&&(s=r>0?s.limitToFirst(r):s.limitToLast(-r)),s},_query_hash:e=>[e.key,e.value,e.limit,e.startAt,e.endAt].join("_"),subscribeQuery(e,t={}){return this.subscribeList(null,{...t,queryParams:e})},fetchNode(e,{noReactiveGetter:t=!1}={}){let r=j.make_reactive_model(this.modelDefinition,null,this._create_context(),!1,t);r.$id=e,r.$promise=z();const i={init:()=>(W(this.name),{}),set:(e,t)=>{W(this.name)}};return this._fetch_individual(e,{customOps:i}).then(e=>{W(this.name),r._update_data(e,this.modelDefinition.schema.fields),r.$ready=!0,r.$promise.resolve(!0)}),r},fetchList({noReactiveGetter:e=!1,queryParams:t=null}={}){let r=t?this.buildQueryRef(t):null,i=j.make_reactive_list(this.modelDefinition,null,this._create_context(),e);i.$promise=z();const n={init:()=>(W(this.name),{}),once:(e,t,r)=>{W(this.name)}};return this._fetch_list({customOps:n,customRef:r}).then(t=>{W(this.name),Object.keys(t||[]).forEach(r=>{let n=t[r],s=j.make_reactive_model(this.modelDefinition,n,this._create_context(),!1,e);s.$id=r,i._add_child(r,s),i.$numReady++}),i.$readyAll=!0,i.$promise.resolve(!0)}),i},fetchQuery(e,t){return this.fetchList({...t,queryParams:e})},getRegistryState:()=>m.state,getAllSyncedPaths(){let e={};return Object.keys(m.state.sync).forEach(t=>{e[t]=m.state.sync[t].status}),e},getData(e=null,t=!1){let r="";if(this.isSuffixed||e){if(!e)throw new Error("getData: id required for suffixed stores");r=this.path.replace(/\{id\}/g,e)}else r=this.path.split("{id}").shift();let i="res."+r.split("/").filter(e=>e).join(".");return m.state.initialized?t?R(m.state,i):(n=m.state,i.split(".").reduce((e,t)=>e[t],n)):null;var n},resetGlobalInstanceCache(){try{Q.forEach(e=>{e.reset()}),J.forEach(e=>{e.reset()})}catch(e){console.warn("Reseting instances failed",e)}Q.clear(),J.clear()}},ee=A((function(e,t){var r="[object Arguments]",i="[object Map]",n="[object Object]",s="[object Set]",o=/^\[object .+?Constructor\]$/,a=/^(?:0|[1-9]\d*)$/,l={};l["[object Float32Array]"]=l["[object Float64Array]"]=l["[object Int8Array]"]=l["[object Int16Array]"]=l["[object Int32Array]"]=l["[object Uint8Array]"]=l["[object Uint8ClampedArray]"]=l["[object Uint16Array]"]=l["[object Uint32Array]"]=!0,l[r]=l["[object Array]"]=l["[object ArrayBuffer]"]=l["[object Boolean]"]=l["[object DataView]"]=l["[object Date]"]=l["[object Error]"]=l["[object Function]"]=l[i]=l["[object Number]"]=l[n]=l["[object RegExp]"]=l[s]=l["[object String]"]=l["[object WeakMap]"]=!1;var c="object"==typeof E&&E&&E.Object===Object&&E,u="object"==typeof self&&self&&self.Object===Object&&self,d=c||u||Function("return this")(),h=t&&!t.nodeType&&t,f=h&&e&&!e.nodeType&&e,_=f&&f.exports===h,m=_&&c.process,p=function(){try{return m&&m.binding&&m.binding("util")}catch(e){}}(),y=p&&p.isTypedArray;function b(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}function g(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function v(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var w,j,A,$=Array.prototype,S=Function.prototype,O=Object.prototype,D=d["__core-js_shared__"],R=S.toString,x=O.hasOwnProperty,T=(w=/[^.]+$/.exec(D&&D.keys&&D.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"",I=O.toString,k=RegExp("^"+R.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),M=_?d.Buffer:void 0,N=d.Symbol,P=d.Uint8Array,G=O.propertyIsEnumerable,U=$.splice,L=N?N.toStringTag:void 0,z=Object.getOwnPropertySymbols,F=M?M.isBuffer:void 0,V=(j=Object.keys,A=Object,function(e){return j(A(e))}),B=ye(d,"DataView"),C=ye(d,"Map"),q=ye(d,"Promise"),Y=ye(d,"Set"),W=ye(d,"WeakMap"),H=ye(Object,"create"),X=we(B),K=we(C),Q=we(q),J=we(Y),Z=we(W),ee=N?N.prototype:void 0,te=ee?ee.valueOf:void 0;function re(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ne(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function se(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ne;++t<r;)this.add(e[t])}function oe(e){var t=this.__data__=new ie(e);this.size=t.size}function ae(e,t){var r=Ae(e),i=!r&&Ee(e),n=!r&&!i&&$e(e),s=!r&&!i&&!n&&xe(e),o=r||i||n||s,a=o?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],l=a.length;for(var c in e)!t&&!x.call(e,c)||o&&("length"==c||n&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ve(c,l))||a.push(c);return a}function le(e,t){for(var r=e.length;r--;)if(je(e[r][0],t))return r;return-1}function ce(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":L&&L in Object(e)?function(e){var t=x.call(e,L),r=e[L];try{e[L]=void 0;var i=!0}catch(e){}var n=I.call(e);i&&(t?e[L]=r:delete e[L]);return n}(e):function(e){return I.call(e)}(e)}function ue(e){return Re(e)&&ce(e)==r}function de(e,t,o,a,l){return e===t||(null==e||null==t||!Re(e)&&!Re(t)?e!=e&&t!=t:function(e,t,o,a,l,c){var u=Ae(e),d=Ae(t),h=u?"[object Array]":ge(e),f=d?"[object Array]":ge(t),_=(h=h==r?n:h)==n,m=(f=f==r?n:f)==n,p=h==f;if(p&&$e(e)){if(!$e(t))return!1;u=!0,_=!1}if(p&&!_)return c||(c=new oe),u||xe(e)?_e(e,t,o,a,l,c):function(e,t,r,n,o,a,l){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new P(e),new P(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return je(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case i:var c=g;case s:var u=1&n;if(c||(c=v),e.size!=t.size&&!u)return!1;var d=l.get(e);if(d)return d==t;n|=2,l.set(e,t);var h=_e(c(e),c(t),n,o,a,l);return l.delete(e),h;case"[object Symbol]":if(te)return te.call(e)==te.call(t)}return!1}(e,t,h,o,a,l,c);if(!(1&o)){var y=_&&x.call(e,"__wrapped__"),b=m&&x.call(t,"__wrapped__");if(y||b){var w=y?e.value():e,j=b?t.value():t;return c||(c=new oe),l(w,j,o,a,c)}}if(!p)return!1;return c||(c=new oe),function(e,t,r,i,n,s){var o=1&r,a=me(e),l=a.length,c=me(t).length;if(l!=c&&!o)return!1;var u=l;for(;u--;){var d=a[u];if(!(o?d in t:x.call(t,d)))return!1}var h=s.get(e);if(h&&s.get(t))return h==t;var f=!0;s.set(e,t),s.set(t,e);var _=o;for(;++u<l;){d=a[u];var m=e[d],p=t[d];if(i)var y=o?i(p,m,d,t,e,s):i(m,p,d,e,t,s);if(!(void 0===y?m===p||n(m,p,r,i,s):y)){f=!1;break}_||(_="constructor"==d)}if(f&&!_){var b=e.constructor,g=t.constructor;b!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g)&&(f=!1)}return s.delete(e),s.delete(t),f}(e,t,o,a,l,c)}(e,t,o,a,de,l))}function he(e){return!(!De(e)||function(e){return!!T&&T in e}(e))&&(Se(e)?k:o).test(we(e))}function fe(e){if(!function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||O;return e===r}(e))return V(e);var t=[];for(var r in Object(e))x.call(e,r)&&"constructor"!=r&&t.push(r);return t}function _e(e,t,r,i,n,s){var o=1&r,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(e);if(c&&s.get(t))return c==t;var u=-1,d=!0,h=2&r?new se:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var f=e[u],_=t[u];if(i)var m=o?i(_,f,u,t,e,s):i(f,_,u,e,t,s);if(void 0!==m){if(m)continue;d=!1;break}if(h){if(!b(t,(function(e,t){if(o=t,!h.has(o)&&(f===e||n(f,e,r,i,s)))return h.push(t);var o}))){d=!1;break}}else if(f!==_&&!n(f,_,r,i,s)){d=!1;break}}return s.delete(e),s.delete(t),d}function me(e){return function(e,t,r){var i=t(e);return Ae(e)?i:function(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}(i,r(e))}(e,Te,be)}function pe(e,t){var r,i,n=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function ye(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return he(r)?r:void 0}re.prototype.clear=function(){this.__data__=H?H(null):{},this.size=0},re.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},re.prototype.get=function(e){var t=this.__data__;if(H){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return x.call(t,e)?t[e]:void 0},re.prototype.has=function(e){var t=this.__data__;return H?void 0!==t[e]:x.call(t,e)},re.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=H&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[],this.size=0},ie.prototype.delete=function(e){var t=this.__data__,r=le(t,e);return!(r<0)&&(r==t.length-1?t.pop():U.call(t,r,1),--this.size,!0)},ie.prototype.get=function(e){var t=this.__data__,r=le(t,e);return r<0?void 0:t[r][1]},ie.prototype.has=function(e){return le(this.__data__,e)>-1},ie.prototype.set=function(e,t){var r=this.__data__,i=le(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},ne.prototype.clear=function(){this.size=0,this.__data__={hash:new re,map:new(C||ie),string:new re}},ne.prototype.delete=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t},ne.prototype.get=function(e){return pe(this,e).get(e)},ne.prototype.has=function(e){return pe(this,e).has(e)},ne.prototype.set=function(e,t){var r=pe(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},se.prototype.add=se.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},se.prototype.has=function(e){return this.__data__.has(e)},oe.prototype.clear=function(){this.__data__=new ie,this.size=0},oe.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},oe.prototype.get=function(e){return this.__data__.get(e)},oe.prototype.has=function(e){return this.__data__.has(e)},oe.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ie){var i=r.__data__;if(!C||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new ne(i)}return r.set(e,t),this.size=r.size,this};var be=z?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,i=null==e?0:e.length,n=0,s=[];++r<i;){var o=e[r];t(o,r,e)&&(s[n++]=o)}return s}(z(e),(function(t){return G.call(e,t)})))}:function(){return[]},ge=ce;function ve(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||a.test(e))&&e>-1&&e%1==0&&e<t}function we(e){if(null!=e){try{return R.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function je(e,t){return e===t||e!=e&&t!=t}(B&&"[object DataView]"!=ge(new B(new ArrayBuffer(1)))||C&&ge(new C)!=i||q&&"[object Promise]"!=ge(q.resolve())||Y&&ge(new Y)!=s||W&&"[object WeakMap]"!=ge(new W))&&(ge=function(e){var t=ce(e),r=t==n?e.constructor:void 0,o=r?we(r):"";if(o)switch(o){case X:return"[object DataView]";case K:return i;case Q:return"[object Promise]";case J:return s;case Z:return"[object WeakMap]"}return t});var Ee=ue(function(){return arguments}())?ue:function(e){return Re(e)&&x.call(e,"callee")&&!G.call(e,"callee")},Ae=Array.isArray;var $e=F||function(){return!1};function Se(e){if(!De(e))return!1;var t=ce(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Oe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function De(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Re(e){return null!=e&&"object"==typeof e}var xe=y?function(e){return function(t){return e(t)}}(y):function(e){return Re(e)&&Oe(e.length)&&!!l[ce(e)]};function Te(e){return null!=(t=e)&&Oe(t.length)&&!Se(t)?ae(e):fe(e);var t}e.exports=function(e,t){return de(e,t)}}));const te=(...e)=>{console.log(...e)};var re={_write_mixin_init(e=!1){if(this.modelDefinition&&this.modelDefinition.staticActions){O({$model:this,$modelsGetter:()=>b},this,this.modelDefinition.staticActions,e)}},add(e,t,r){let i=null;if(t||(t=this._get_uid()),!t[".sv"]&&!this._validate_id(t))throw new Error("Got invalid id:"+t);let n=!0;return r&&r.directWrite&&(n=!1),this.modelDefinition?(n?this.modelDefinition.schema&&this.modelDefinition.schema.create?(this._check_required_create_arg(e),i=this.modelDefinition.schema.create(e,e,"REALTIMEDB")):(console.warn("No create function found in type definition, using overwrite data as payload."),i=e):i=e,this.modelDefinition.schema?this._validate_schema(i,!1):console.warn("No schema found to validate input")):(console.warn("No type definition found, using UNVALIDATED overwrite data as payload."),i=e),this._convert_moment_objects(i),te("[GENS] Creating at",this.previewPath(t),"with payload",i),this.isSuffixed?this.childRef(t).update(i).then(()=>t):this.parentRef.update({[t]:i}).then(()=>t)},update(e,t){if(!e||!t)throw new Error("Either id or data is missing.");if(!this._validate_id(e)){if(!(this.modelDefinition.schema||{}).unsafe_disable_validation)throw new Error("Got invalid id in update");console.warn("Got invalid id <"+e+">, but validation is disabled.")}this.modelDefinition.schema?this._validate_schema(t,!0):console.warn("No schema found to validate input");let r=t;return this._convert_moment_objects(r),te("[GENS] Updating at",this.previewPath(e),"with payload",r),this.childRef(e).update(r)},reorder(e,t={}){if(this.isSuffixed)throw new Error("Suffixed store does not support reorder");let r=t.overwriteSortIdxKey||"sortidx";if(e.length>0&&"object"!=typeof e[0]){let t=0;e=e.map(e=>(t+=100,{id:e,sortidx:t}))}let i={};e.forEach(e=>{let t=e.sortidx;if(e.id=e.id||e.$id,"number"!=typeof t&&(t=parseFloat(t)),isNaN(t))throw new Error("Got invalid sortidx",t);if(!this._validate_id(e.id))throw new Error("Got invalid id",e.id);i[e.id]={[r]:t}});let n={};return Object.keys(i).forEach(e=>{let t=i[e];Object.keys(t).forEach(r=>{n[this.previewPath(e)+"/"+r]=t[r]})}),te("[GENS] update at",this.previewPath(),"with payload",n),this.rootRef.update(n)},remove(e,t){if(t=void 0===t?this.defaultDeleteMode===d.SOFT:t,Array.isArray(e)){const r={};return e.forEach(e=>{if(!this._validate_id(e))throw new Error("Got invalid id in remove");t?r[e+"/deleted"]=!0:r[e]=null}),te("[GENS] batch deleting at",this.path,"with payload",r),this.parentRef.update(r)}if(!this._validate_id(e))throw new Error("Got invalid id in remove");return t?(te("[GENS] soft deleting at",this.path,"with",{deleted:!0}),this.update(e,{deleted:!0})):(te("[GENS] hard deleting at",this.path),this.childRef(e).remove())},restore(e){return this.update(e,{deleted:!1})},copy(e,t,r){return this.move(e,t,r,{keepOriginal:!0,keepId:!1})},move(e,t,r,{keepOriginal:i=!1,keepId:n=!0}={}){if(this.isSuffixed)throw new Error("Suffixed store does not support move");if(!this._validate_id(e))throw new Error("Got invalid id in remove");let s=Object.keys(t).sort(),o=Object.keys(r).sort();if(!ee(s,o))throw new Error("Context A and context B do not have equal keys");let a=Object.assign({},this.definedProps,t,{id:e}),l=Object.assign({},this.definedProps,r,{id:e});n||(l.id=this._get_uid());let c=this.templatePath.replace(/\*/,"{id}"),u=h(c,a),d=h(c,l),_=f(u);if(_.length>0)throw new Error("Not all template id's are defined. Required fields are "+_.join(", "));return this._db.ref(u).once("value").then(e=>e.val()).then(e=>{let t={[u]:null,[d]:e};return i&&(t={[d]:e}),te("[GENS] moving data from ",u,"to",d,"with payload",t),this.rootRef.update(t).then(()=>l.id)})},transaction(e,t,r,i=1){if(!this._validate_id(e))throw new Error("Got invalid id in remove");let n=this.childRef(e);if(t&&(this._validate_schema({[t]:1}),n=n.ref.child(t)),"string"==typeof r)switch(r){case"inc":r=e=>(e||0)+i;break;case"dec":r=e=>(e||0)-i}if("function"!=typeof r)throw new Error("Transacton must be a function");return te("[GENS] tranaction on ",n.path.toString()),n.transaction(r).then(e=>e.committed?(console.log("[GENS] Transacton successfully committed"),!0):(console.log("[GENS] Transacton aborted"),!1))},new(){return j.make_reactive_model(this.modelDefinition,null,this._create_context(),!1)},newFromTemplate(e={},t=null){let r=this.empty(e,t),i=j.make_reactive_model(this.modelDefinition,e,this._create_context(),!1);return i._update_data(r,null,!0),i},newFromData(e={},t=!1){return j.make_reactive_model(this.modelDefinition,e,this._create_context(),!1)},empty(e={},t=null){if(!this.modelDefinition)return null;if(!this.modelDefinition.schema||!this.modelDefinition.schema.create)return null;this._check_required_create_arg(e);let r=this.modelDefinition.schema.create(e,t||e,"REALTIMEDB");return this.modelDefinition.schema?this._validate_schema(r,!1):console.warn("No schema found to validate input"),r},_convert_moment_objects(e){if("object"!=typeof e)throw console.log("Got payload",e,typeof e),new Error("Expected object, got "+e);for(let t in e)if(a.isMoment(e[t])){if(!e[t].toRealtimeDB)throw new Error("Moment object passed to add/update must be enhanced moment objects.");e[t]=e[t].toRealtimeDB()}else Array.isArray(e[t])?this._convert_moment_objects(e[t]):"object"==typeof e[t]&&this._convert_moment_objects(e[t])}};const ie=require("slugid"),ne=(...e)=>{console.log(...e)};let se,oe=null,ae=null,le=null,ce={userId:null};class GenericStore{constructor(e,t,r={}){if(t&&(t.abstract_store||r.isAbstract))this.isAbstract=!0,this.templatePath=e,this.modelDefinition=t,this.definedProps={},this.name="unnamed abstract";else{if(this.isAbstract=!1,this.name="unnamed",!e||e.length<2)throw new Error("Invalid template path:"+e);if("/"!==e[0])throw new Error("Template path has to start with /, got: "+e);if(1!==(e.match(/\*/g)||[]).length)throw new Error("Template path must contain exactly one *, got:"+e);this.isSuffixed=e.indexOf("*")!==e.length-1,"function"==typeof r.uidMethod?(this.uidMethod=u.CUSTOM,this.uidMethodCallback=r.uidMethod):this.uidMethod=r.uidMethod||u.PUSHID,this.additionalProps=r.additionalProps||[],this.defaultDeleteMode="defaultDeleteMode"in r?r.defaultDeleteMode:d.HARD}this.enableTypeValidation=!("enableTypeValidation"in r)||r.enableTypeValidation,this.autoUnsubscribe=!("autoUnsubscribe"in r)||r.autoUnsubscribe,this.isReadonly=r.isReadonly,this.templatePath=e,this.modelDefinition=t,this.definedProps={},this._localDB=null,this._clones=[],this.global_store_path_array=[],this.isSuffixed||(this.global_store_path=""),this.isAbstract?(Object.assign(this,{_read_mixin_init:Z._read_mixin_init,_write_mixin_init:re._write_mixin_init}),this._read_mixin_init(),this._write_mixin_init()):(Object.assign(this,Z),this._read_mixin_init(),this.isReadonly||(Object.assign(this,re),this._write_mixin_init()))}_clone(){const e=Object.getPrototypeOf(this),t=Object.create(e),r=Object.assign(t,this);return delete r.getters,delete r._vm,r._read_mixin_init(),this.isReadonly||r._write_mixin_init(!0),r._clones=[],this._clones.push(r),r}setName(e){this.name=e}generateId(){return this._get_uid()}_get_uid(){switch(this.uidMethod){case u.SLUGID:return ie.nice();case u.PUSHID:return this.rootRef.push().key;case u.TIMESTAMP:return le.database.ServerValue.TIMESTAMP;case u.LOCAL_TIMESTAMP:return a.currentTime().unix();case u.DATE:return a.currentDate().format("DD-MM-YYYY");case u.OTHER_USER_ID:throw new Error("Please provide id through id override");case u.MY_USER_ID:if(!GenericStore.defaultUserId)throw new Error("User ID is not set, but a store uses USER_ID as key");return GenericStore.defaultUserId;case u.ARRAY:return 0;case u.EMAIL:throw new Error("Only email addresses allowed as key");case u.CUSTOM:let e=this.uidMethodCallback(this.definedProps);if(!e)throw new Error("An ID was not defined. Check custom UID Callback.");return e;default:throw new Error("Unknown UID Method: "+this.uidMethod)}}static setDefaultDB(e){oe=e}get _db(){return this._localDB||oe}_validate_id(e){return!(this.uidMethod===u.SLUGID&&!function(e){return r(e)&&e.length&&e.length>=20}(e))&&!(-1===e||!e)}_define_user(){GenericStore.defaultUserId&&(this.definedProps.uid=GenericStore.defaultUserId)}static get defaultUserId(){return ce.userId}get defaultUserId(){return ce.userId}static set defaultUserId(e){ne("[GENS] settings default user id to: uid =",e),se.set(ce,"userId",e)}static resetState(){ne("[GENS] reset state"),se.set(ce,"userId",null)}get path(){"uid"in this.definedProps||this._define_user();let e=h(this.templatePath,this.definedProps),t=f(e);if(t.length>0)throw new Error("Not all template id's are defined. Required fields are "+t.join(", "));return e.replace(/\*/g,"{id}")}previewPath(e){"uid"in this.definedProps||this._define_user();let t=h(this.templatePath,this.definedProps);return t=e?t.replace(/\*/g,e):t.replace(/\*/,"{id}"),t}childRef(e){return this._db.ref(this.path.replace(/\{id\}/g,e))}get parentRef(){return this._db.ref(this.path.split("{id}").shift())}get rootRef(){return this._db.ref()}define(e,t){e.definedProps=Object.assign({},this.definedProps,t);let r=[].concat(this._template_path_field_names,this.additionalProps);for(var i in t)r.includes(i)||console.warn("Prop",i,"not found in template path. Known fields are",r);return e}with(e){let t=this._clone();return this.define(t,e)}get _template_path_field_names(){return f(this.templatePath)}reset(e=1){1===e&&(this.name,this._clones.length),this.definedProps={},e>3?console.warn("[GENS] RESET - Stop at recursion level 3",this._clones):this._clones.forEach(t=>{t.reset(e+1)})}get schemaFields(){let e=((this.modelDefinition||{}).schema||{}).fields;return void 0===e?[]:(Array.isArray(e)||(e=Object.keys(e).map(t=>({model:t,...e[t]}))),e)}get schemaRequiredFields(){return this.schemaFields.filter(e=>e.required).map(e=>e.model)}get schemaOptionalFields(){return this.schemaFields.filter(e=>!e.required).map(e=>e.model)}get schemaAllFields(){return this.schemaFields.map(e=>e.model)}_check_required_fields(e){this.schemaRequiredFields.forEach(t=>{if(!(t in e))throw new Error("Required field <"+t+"> not present.")})}_check_required_create_arg(e){(((this.modelDefinition||{}).schema||{}).create_required||[]).forEach(t=>{if(!(t in e))throw new Error("Required create argument <"+t+"> not present.")})}_validate_schema(e,t){if(this.modelDefinition&&this.modelDefinition.schema&&this.modelDefinition.schema.unsafe_disable_validation)return;let r=this.schemaFields;if(!(r&&r.length>=0))throw new Error('No schema found for "'+this.name+'", please provide one.');{t||this._check_required_fields(e);const i=/Map\s*<(?<key>\w+),\s*(?<val>\w+)>/i,n=/(?<val>\w+)\s*\[\]/;let s=this.schemaAllFields,o=[],a={};0===r.length?console.warn('Schema for "'+this.name+'" is empty.'):(a=Object.assign(...s.map((e,t)=>(e.startsWith("/")&&e.endsWith("/")&&o.push(e),{[e]:this.schemaFields[t]}))),Object.keys(a).forEach((e,t)=>{let r=a[e].type||"";if(i.test(r)){let r="/^"+e+"\\/((?![\\/\\[\\]\\.\\#\\$\\/\\u0000-\\u001F\\u007F]).)*$/";o.push(r),a[r]=this.schemaFields[t]}})),Object.keys(e).forEach(t=>{let r=o.find(e=>{const r=e.includes("\\u00")?"":"u";return new RegExp(e.substring(1,e.length-1),r).test(t)});if(!r&&!s.includes(t))throw new Error("Field <"+t+"> is not allowed by schema.");let l=a[r||t];if(l.validator){let r=l.validator(e[t],l,null);if(!r||r.length&&0===r.length)throw new Error('User-defined schema validation failed for key "'+t+'" with error: '+r)}if(this.enableTypeValidation){if(!(l.type||"").split("|").some(r=>{let s=r.trim(),o={};return n.test(s)&&(o=n.exec(s).groups,s="Array"),i.test(s)&&(o=i.exec(s).groups,s="Map"),!l.required&&null===e[t]||this._validate_bolt_type(e[t],s,o)}))throw new Error('Type-based schema validation failed for key "'+t+'" with error.')}})}}_validate_bolt_type(e,t,o={}){switch(t.toLowerCase()){case"string":return r(e);case"number":return l=e,!isNaN(parseFloat(l))&&isFinite(l);case"boolean":return!0===(a=e)||!1===a;case"object":return i(e)&&n(e)&&!s(e);case"any":return i(e);case"null":return null===e;case"map":return n(e)&&!s(e)&&Object.entries(e).every(([e,t])=>{let i=r(e),n=this._validate_bolt_type(t,o.val);return i&&n});case"array":let c=[];if(s(e))c=e;else{if(!n(e))return!1;c=Object.values(e)}return c.every(e=>this._validate_bolt_type(e,o.val));default:return console.warn("Can not validate type '"+t+"'"),!0}var a,l}static _set_caller(e){if(!0!==e._isVue)return!1;ae=e}get _last_caller(){return ae}get rules(){let e=this.modelDefinition.schema.fields;Array.isArray(e)||(e=Object.keys(e).map(t=>({model:t,...e[t]})));let t={};return e.forEach(e=>{t[e.model]=[{validator:(t,r,i)=>{e.validator(r)?i():i(new Error("Invalid input"))},trigger:"blur"}]}),t}}var ue={strict:!0,state:{initialized:!1,res:{},sync:{},ready:{}},getters:{get_registry_entry:e=>t=>e.sync[t],is_ready:e=>t=>e.ready[t]||!1},mutations:{...{"heliosrx/INIT_VALUE":(e,{path:t,data:r})=>I(e,t,r),"heliosrx/UNSET_VALUE":(e,{path:t})=>I(e,t,{".value":null}),"heliosrx/ARRAY_ADD"(e,{target:t,newId:r,data:i}){p.set(t,r,i)},"heliosrx/ARRAY_REMOVE"(e,{target:t,oldId:r}){p.delete(t,r)},"heliosrx/ARRAY_SET"(e,{target:t,currentId:r,data:i,performMerge:n=!1}){t[r]?T(t[r],i,!n):t[r]=i},"heliosrx/SET"(e,{target:t,data:r,performMerge:i=!1}){T(t,r,!i)}},INIT_REGISTRY(e){e.initialized=!0},RESET_REGISTRY(e){p.set(e,"sync",{}),p.set(e,"res",{}),p.set(e,"ready",{}),e.initialized=!1},ADD_ENTRY(e,{name:t,data:r}){e.sync[t]&&e.sync[t]===r||p.set(e.sync,t,r)},SET_ENTRY_STATUS(e,{name:t,value:r}){e.sync[t][status]&&e.sync[t][status]===r||p.set(e.sync[t],"status",r)},SET_GLOBAL_READY_STATE(e,{name:t,value:r}){e.ready[t]&&e.ready[t]===!!r||p.set(e.ready,t,!!r)},REM_GLOBAL_READY_STATE(e,{name:t}){p.delete(e.ready,t)}}};function de(e){return ue.name=e,ue.namespaced=!0,ue}let he;var fe={registerStore(){},removeStore(){},getAllStores(){},resetAllStores(){}};function _e(e){GenericStore.setDefaultDB(e)}function me(e){if(null!==GenericStore.defaultUserId)throw new Error("Call resetGenericStores before setting the default user id");GenericStore.defaultUserId=e}function pe(e=!0){GenericStore.resetState();const t=fe.getAllStores();for(var r in t){let i=t[r],n=i.subscriptions;i.reset(),e&&n&&Object.keys(n).forEach(e=>{let t=n[e];console.log("Calling unsubscribe for",r,":",e),t()})}}const ye="0.2.3";class heliosRX{static install(){}}heliosRX.install=function e(t,r){if(e.installed&&he===t)return;if(e.installed=!0,console.log("[GENS] Installing Generic API plugin"),!r)throw new Error('heliosRX: Missing configuration. Did you supply config with Vue.use("heliosRx", {...})?');if(!r.db)throw new Error('heliosRX: Missing configuration "db".');if(!r.models)throw new Error('heliosRX: Missing configuration "models".');he=t,v({Vue:t,models:r.models,db:r.db});let i,n=r.db;if(function({Vue:e,firebase:t}){se=e,ce=se.observable(ce),j.configure({GenericModel:GenericModel,GenericList:GenericList}),le=t}({Vue:t,firebase:r.firebase||r.db.app.firebase_}),!n.app||!n.app.database)throw"object"==typeof n?new Error("heliosRX: Multi-DB configuration not implemented yet."):new Error("heliosRX: Invalid configuration for db.");if(GenericStore.setDefaultDB(r.db),r.useExistingStore){const e=r.useExistingStore;throw e.registerModule("heliosrx",de("heliosRX")),v({Vuex:y,registry:e}),new Error("heliosRX: Custom state management not fully implemented.")}(t._installedPlugins||[]).forEach(e=>{e.Store&&e.mapActions&&console.warn("Existing Vuex detected. Consider using 'useExistingStore'. See heliosRX documentation.")}),t.use(y),i=new y.Store(de("heliosRX")),v({Vuex:y,registry:i}),i.commit("INIT_REGISTRY"),Object.defineProperty(t.prototype,"$models",{get(){return GenericStore._set_caller(this),r.models}});let s={};r.userApi&&(s=r.userApi),Object.defineProperty(t.prototype,"$api",{get:()=>s});let o="false"===process.env.VUE_APP_PRODUCTION&&process.browser;(!0===r.devMode||void 0===r.devMode&&o)&&(window.$models=r.models,window.$db=r.db,window.$api=s,window.$registry=i)},heliosRX.getRegistry=w,heliosRX.GenericStore=GenericStore,heliosRX.version="0.2.3";export default heliosRX;export{d as DeleteMode,GenericStore,u as UIDMethod,w as getRegistry,a as moment,de as registryModule,pe as resetGenericStores,_e as setDefaultDB,me as setDefaultUser,ye as version};