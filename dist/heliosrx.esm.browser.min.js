/**
 * heliosRX v0.2.4
 * (c) 2020 Thomas Weustenfeld
 * @license MIT
 */
/**
 * heliosRX v0.2.4
 * (c) 2020 Thomas Weustenfeld
 * @license MIT
 */
import e from"vue";import t from"vuex";var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var n=r((function(e){var t,r;t=i,r=function(){var e=function(){},t="undefined"!=typeof window&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function n(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(i){return"debug"===i&&(i="log"),"undefined"!=typeof console&&("trace"===i&&t?n:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}function o(t,r){for(var n=0;n<i.length;n++){var s=i[n];this[s]=n<t?e:this.methodFactory(s,t,r)}this.log=this.debug}function a(e,t,i){return function(){"undefined"!=typeof console&&(o.call(this,t,i),this[e].apply(this,arguments))}}function l(e,t,i){return s(e)||a.apply(this,arguments)}function c(e,t,r){var n,s=this,a="loglevel";function c(){var e;if("undefined"!=typeof window){try{e=window.localStorage[a]}catch(e){}if(void 0===e)try{var t=window.document.cookie,i=t.indexOf(encodeURIComponent(a)+"=");-1!==i&&(e=/^([^;]+)/.exec(t.slice(i))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}e&&(a+=":"+e),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||l,s.getLevel=function(){return n},s.setLevel=function(t,r){if("string"==typeof t&&void 0!==s.levels[t.toUpperCase()]&&(t=s.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(n=t,!1!==r&&function(e){var t=(i[e]||"silent").toUpperCase();if("undefined"!=typeof window){try{return void(window.localStorage[a]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+t+";"}catch(e){}}}(t),o.call(s,t,e),"undefined"==typeof console&&t<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){c()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var d=c();null==d&&(d=null==t?"WARN":t),s.setLevel(d,!1)}var d=new c,u={};d.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new c(e,d.getLevel(),d.methodFactory)),t};var h="undefined"!=typeof window?window.log:void 0;return d.noConflict=function(){return"undefined"!=typeof window&&window.log===d&&(window.log=h),d},d.getLoggers=function(){return u},d},e.exports?e.exports=r():t.log=r()}));var s=Object.freeze({__proto__:null,WARNING_DEFINE_UNKNOWN_PROP:"store/define-unknown-prop",WARNING_RESET_MAX_DEPTH:"store/reset-max-depth-reached",WARNING_NO_CREATE_FUNCTION:"model/no-create-function",WARNING_INVALID_ID:"model/invalid-id",WARNING_EMPTY_SCHEMA:"model/empty-schema",WARNING_UKNONWN_VALIDATION_TYPE:"model/unknown-validation-type",WARNING_MODEL_INVALID_MOMENT:"model/invalid-moment",WARNING_MODEL_OTHER:"model/other",WARNING_NO_SCHEMA:"model/no-schema",WARNING_NAME_CONFLICT:"model/no-name-conflict",WARNING_CLIENT_VALIDATION:"model/client-validation-failed",WARNING_UNKNOWN_TIMESTAMP_TYPE:"model/unknown-timestamp-type",WARNING_WRITING_UNDEFINED:"model/writing-undefined",WARNING_INVALID_TIMESTAMP_SERVER:"model/invalid-timestamp-from-server",WARNING_MOMENT_INVALID_DATE:"moment/invalid-date",WARNING_DEPRECATED:"common/deprecated",WARNING_COMMON:"common/common",WARNING_SYNCING_SUBSET_DATA:"read/sync-subset-data",WARNING_SYNCING_INDIVIDUAL:"read/sync-individial-but-list-supported",WARNING_SYNCING_EXISTING_QUERY_PATH:"read/sync-existing-query-path",WARNING_ACCESSING_UNSYNCED_DATA:"read/accessing-unsynced-data",WARNING_PERMISSION_DENIED:"read/permission-denied",INFO_COMMON:"common",INFO_MODEL:"model",INFO_COLLECTION:"collection",INFO_STORE:"store",INFO_STORE_WRITE:"store-write",INFO_MOMENT:"moment",INFO_REGISTRY:"registry",INFO_DEEPMERGE:"deep-merge",INFO_PERMISSION:"permission",INFO_AUTO_UNSUBSCRIBE:"store/unsubscribe/auto",INFO_SUBSCRIBE:"store/subscribe",INFO_SUBSCRIBE_QUERY:"store/subscurbe/query",INFO_SUBSCRIBE_DETAILS:"store/subscribe/details",INFO_READ_INIT:"store/subscribe/init",INFO_READ_REMOVE:"store/unsubscribe"});n.noConflict(),n.setDefaultLevel("warn"),n.setLevel("warn");const o={common:"heliosRX",model:"heliosRX",collection:"heliosRX",store:"heliosRX","store-write":"heliosRX:write",moment:"heliosRX:moment",registry:"heliosRX:REGISTRY","deep-merge":"heliosRX:DEEPMERGE",permission:"heliosRX:permission","store/unsubscribe/auto":"heliosRX:auto-unsubscribe","store/subscribe":"heliosRX:subscribe","store/subscribe/details":"heliosRX:subscribe","store/subscurbe/query":"heliosRX:query","store/subscribe/init":"heliosRX:moment","store/unsubscribe":"heliosRX:moment"};function a(e,...t){return n.getLogger(e).warn(...t)}function l(e,...t){let i=o[e]||e;return n.getLogger(e).info(`[${i}]`,...t)}function c(e,...t){let i=o[e]||e;return n.getLogger(e).info(`[${i}]`,...t)}function d(e){return"[object String]"===Object.prototype.toString.call(e)}function u(e){return!isNaN(parseFloat(e))&&isFinite(e)}function h(e){return null!=e}function f(e){return"object"==typeof e&&null!==e}function m(e){return Array.isArray(e)}n.getLogger("read/sync-individial-but-list-supported").setLevel("silent");const _={database:{ServerValue:{TIMESTAMP:{".sv":"timestamp"}}},firestore:{FieldValue:{serverTimestamp(){throw new Error("Not Implemented")}}}},p=require("moment-timezone/builds/moment-timezone-with-data-2012-2022.min.js");var y;y=process.browser?window.localStorage:{getItem:()=>"Europe/Berlin",setItem(){}};const b=(e,t)=>{let i=e.clone().utc().format(),r=i.substring(0,i.length-1);return p.tz(r,t)};!function(){l("moment","set up"),l("moment","localStorage.getItem('timezone')",y.getItem("timezone")),y.getItem("timezone")||y.setItem("timezone",p.tz.guess());let e=y.getItem("timezone");l("moment","Setting user timezone to",e),p.tz.setDefault(e),p.user_timezone=e,function(e){l("moment","enhanceMomentJS"),e.isEnhanced=!0,e.prototype.isEnhanced=!0,e.fromFirestore=t=>t&&"object"==typeof t&&"Timestamp"===t.constructor.name?e(t.toDate()):e(t),e.fromRealtimeDB=t=>e.unix(t),e.fromRealtimeServerTime=t=>e(t),e.fromStore=t=>e(t),e.prototype.toFirestore=function(){return _.firestore.Timestamp.fromDate(this.toDate())},e.prototype.toRealtimeDB=function(){return this.unix()},e.prototype.toRealtimeServerTime=function(){return this.valueOf()},e.prototype.toBackend=function(e){return"REALTIMEDB"===e?this.toRealtimeDB():this.toFirestore()},e.prototype.toStore=function(){return this.format()},e.prototype.formatDateLong=function(){return this.format(this.user_dateformat)},e.prototype.isTimezoneNeutral=!1,e.fromDateAndTime=(t,i)=>{if(!i)throw new Error("Not implemented");let r=e.tz(t+"T"+i,e.user_timezone);return r.isTimezoneNeutral=!0,r},e.fromTimezoneNeutral=t=>{if(!e.isValidDate(t))return a("moment/invalid-date","[fromTimezoneNeutral]","Invalid date",t),null;if(!t.isTimezoneNeutral)throw new Error("Input is not timezone neutral");return b(t,e.user_timezone)},e.prototype.changeTimezoneButKeepTime=function(e){return b(this,e)},e.isValidDate=function(t){return t&&e.isMoment(t)&&!!t.isEnhanced&&t.isValid()},e.currentTime=()=>{if(!e.user_timezone)throw new Error("User timezone is not set");return e().tz(e.user_timezone)},e.currentTimeUTC=()=>e().utc(),e.currentDate=()=>e().tz(e.user_timezone).startOf("day"),e.currentDateISO=()=>{e().tz(e.user_timezone).format("YYYY-MM-DD")},e.currentDateSleepCorrected=()=>e().tz(e.user_timezone).subtract(3,"hours").startOf("day"),e.currentCalendarweek=()=>e().tz(e.user_timezone).format("W"),e.currentTimeServer=e=>"REALTIMEDB"===e?_.database.ServerValue.TIMESTAMP:_.firestore.FieldValue.serverTimestamp(),e.convertHHmmToFractional=t=>(e(t,"HH:mm")-e().startOf("day"))/3600/1e3,e.convertFractionalToHHmm=t=>e.utc(3600*t*1e3).format("HH:mm"),e.parseTimeNatural=(t,i=null)=>{if(!(t=(t||"").trim()))return null;if("+"===t[0]||"-"===t[0]){let r="-"===t[0]?-1:1,n=t.slice(1);/[mhs]/i.test(n)||(n+="m");let s=null;if(!s.match)return null;let o=r*s.duration;return e(i,"HH:mm").add(o,"seconds")}return"now"===t?e():e(t,["HH:mm","HH:mm A","HH A","HH"])},process.browser&&(window.moment=e)}(p)}();const g={CUSTOM:1,SLUGID:2,PUSHID:3,TIMESTAMP:4,LOCAL_TIMESTAMP:5,DATE:6,OTHER_USER_ID:7,MY_USER_ID:8,ARRAY:9,EMAIL:10},v={SOFT:0,HARD:1};function w(e,t,i){return e.replace(/\{.+?}/g,e=>function(e,t,i=`{${e}}`){return e.split(".").reduce((e,t)=>e[t]||i,t)}(e.substr(1,e.length-2).trim(),t,i))}function E(e){return(e.match(/\{.+?}/g)||[]).map(e=>e.slice(1,-1))}let A,R,S=e,I=t,N={},O={};function j(e){e.Vue&&(S=e.Vue),e.Vuex&&(I=e.Vuex),e.Firebase&&(A=e.Firebase),e.registry&&(R=e.registry),e.models&&(N=e.models),e.db&&(O=e.db)}function T(){return R}var D={configure({GenericList:GenericList,GenericModel:GenericModel}){this.GenericList=GenericList,this.GenericModel=GenericModel},make_reactive_list(e,t,i,r=!1){let n=i.model.name,s=new this.GenericList(n);if(t){for(let r in t){let n=this.make_reactive_model(e,t[r],i);n.$id=r,n._update_data(t[r],e.schema.fields),s._add_child(r,n)}s.$readyAll=!0,s.$numReady=Object.keys(t).length}return e.listActions&&s._decorate_actions(e.listActions,i),!e.listGetters||r||e.no_reactive_getters||s._decorate_getters(e.listGetters,i),S.observable(s),s},make_reactive_model(e,t,i,r=!1,n=!1){let s=i.model.name,o=new this.GenericModel(null,null,s);return o._set_generic_store(i.model),e.schema&&e.schema.fields?o._autogenerate_props(e.schema.fields,t,r):a("model/no-schema","Making a reactive model without schema. This means props are not autogenerated and only accessible through model.$state. Please provide a schema for "+s+"."),t&&(o._update_data(t,e.schema.fields),o.$ready=!0),e.modelActions&&o._decorate_actions(e.modelActions,i),!e.modelGetters||n||e.no_reactive_getters||o._decorate_getters(e.modelGetters,i),S.observable(o),o}},$=r((function(e,t){var r="[object Arguments]",n="[object Function]",s="[object GeneratorFunction]",o="[object Map]",a="[object Set]",l=/\w*$/,c=/^\[object .+?Constructor\]$/,d=/^(?:0|[1-9]\d*)$/,u={};u[r]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object DataView]"]=u["[object Boolean]"]=u["[object Date]"]=u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u[o]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u[a]=u["[object String]"]=u["[object Symbol]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Error]"]=u[n]=u["[object WeakMap]"]=!1;var h="object"==typeof i&&i&&i.Object===Object&&i,f="object"==typeof self&&self&&self.Object===Object&&self,m=h||f||Function("return this")(),_=t&&!t.nodeType&&t,p=_&&e&&!e.nodeType&&e,y=p&&p.exports===_;function b(e,t){return e.set(t[0],t[1]),e}function g(e,t){return e.add(t),e}function v(e,t,i,r){var n=-1,s=e?e.length:0;for(r&&s&&(i=e[++n]);++n<s;)i=t(i,e[n],n,e);return i}function w(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function E(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function A(e,t){return function(i){return e(t(i))}}function R(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var S,I=Array.prototype,N=Function.prototype,O=Object.prototype,j=m["__core-js_shared__"],T=(S=/[^.]+$/.exec(j&&j.keys&&j.keys.IE_PROTO||""))?"Symbol(src)_1."+S:"",D=N.toString,$=O.hasOwnProperty,x=O.toString,M=RegExp("^"+D.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),L=y?m.Buffer:void 0,P=m.Symbol,k=m.Uint8Array,G=A(Object.getPrototypeOf,Object),U=Object.create,F=O.propertyIsEnumerable,C=I.splice,V=Object.getOwnPropertySymbols,z=L?L.isBuffer:void 0,W=A(Object.keys,Object),B=pe(m,"DataView"),Y=pe(m,"Map"),q=pe(m,"Promise"),H=pe(m,"Set"),X=pe(m,"WeakMap"),K=pe(Object,"create"),Q=we(B),J=we(Y),Z=we(q),ee=we(H),te=we(X),ie=P?P.prototype:void 0,re=ie?ie.valueOf:void 0;function ne(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function se(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function oe(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ae(e){this.__data__=new se(e)}function le(e,t){var i=Ae(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Re(e)}(e)&&$.call(e,"callee")&&(!F.call(e,"callee")||x.call(e)==r)}(e)?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],n=i.length,s=!!n;for(var o in e)!t&&!$.call(e,o)||s&&("length"==o||ge(o,n))||i.push(o);return i}function ce(e,t,i){var r=e[t];$.call(e,t)&&Ee(r,i)&&(void 0!==i||t in e)||(e[t]=i)}function de(e,t){for(var i=e.length;i--;)if(Ee(e[i][0],t))return i;return-1}function ue(e,t,i,c,d,h,f){var m;if(c&&(m=h?c(e,d,h,f):c(e)),void 0!==m)return m;if(!Ne(e))return e;var _=Ae(e);if(_){if(m=function(e){var t=e.length,i=e.constructor(t);t&&"string"==typeof e[0]&&$.call(e,"index")&&(i.index=e.index,i.input=e.input);return i}(e),!t)return function(e,t){var i=-1,r=e.length;t||(t=Array(r));for(;++i<r;)t[i]=e[i];return t}(e,m)}else{var p=be(e),y=p==n||p==s;if(Se(e))return function(e,t){if(t)return e.slice();var i=new e.constructor(e.length);return e.copy(i),i}(e,t);if("[object Object]"==p||p==r||y&&!h){if(w(e))return h?e:{};if(m=function(e){return"function"!=typeof e.constructor||ve(e)?{}:function(e){return Ne(e)?U(e):{}}(G(e))}(y?{}:e),!t)return function(e,t){return me(e,ye(e),t)}(e,function(e,t){return e&&me(t,Oe(t),e)}(m,e))}else{if(!u[p])return h?e:{};m=function(e,t,i,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return fe(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return function(e,t){var i=t?fe(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var i=t?fe(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}(e,r);case o:return function(e,t,i){return v(t?i(E(e),!0):E(e),b,new e.constructor)}(e,r,i);case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,l.exec(e));return t.lastIndex=e.lastIndex,t}(e);case a:return function(e,t,i){return v(t?i(R(e),!0):R(e),g,new e.constructor)}(e,r,i);case"[object Symbol]":return s=e,re?Object(re.call(s)):{}}var s}(e,p,ue,t)}}f||(f=new ae);var A=f.get(e);if(A)return A;if(f.set(e,m),!_)var S=i?function(e){return function(e,t,i){var r=t(e);return Ae(e)?r:function(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}(r,i(e))}(e,Oe,ye)}(e):Oe(e);return function(e,t){for(var i=-1,r=e?e.length:0;++i<r&&!1!==t(e[i],i,e););}(S||e,(function(r,n){S&&(r=e[n=r]),ce(m,n,ue(r,t,i,c,n,e,f))})),m}function he(e){return!(!Ne(e)||(t=e,T&&T in t))&&(Ie(e)||w(e)?M:c).test(we(e));var t}function fe(e){var t=new e.constructor(e.byteLength);return new k(t).set(new k(e)),t}function me(e,t,i,r){i||(i={});for(var n=-1,s=t.length;++n<s;){var o=t[n],a=r?r(i[o],e[o],o,i,e):void 0;ce(i,o,void 0===a?e[o]:a)}return i}function _e(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function pe(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return he(i)?i:void 0}ne.prototype.clear=function(){this.__data__=K?K(null):{}},ne.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ne.prototype.get=function(e){var t=this.__data__;if(K){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return $.call(t,e)?t[e]:void 0},ne.prototype.has=function(e){var t=this.__data__;return K?void 0!==t[e]:$.call(t,e)},ne.prototype.set=function(e,t){return this.__data__[e]=K&&void 0===t?"__lodash_hash_undefined__":t,this},se.prototype.clear=function(){this.__data__=[]},se.prototype.delete=function(e){var t=this.__data__,i=de(t,e);return!(i<0)&&(i==t.length-1?t.pop():C.call(t,i,1),!0)},se.prototype.get=function(e){var t=this.__data__,i=de(t,e);return i<0?void 0:t[i][1]},se.prototype.has=function(e){return de(this.__data__,e)>-1},se.prototype.set=function(e,t){var i=this.__data__,r=de(i,e);return r<0?i.push([e,t]):i[r][1]=t,this},oe.prototype.clear=function(){this.__data__={hash:new ne,map:new(Y||se),string:new ne}},oe.prototype.delete=function(e){return _e(this,e).delete(e)},oe.prototype.get=function(e){return _e(this,e).get(e)},oe.prototype.has=function(e){return _e(this,e).has(e)},oe.prototype.set=function(e,t){return _e(this,e).set(e,t),this},ae.prototype.clear=function(){this.__data__=new se},ae.prototype.delete=function(e){return this.__data__.delete(e)},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var i=this.__data__;if(i instanceof se){var r=i.__data__;if(!Y||r.length<199)return r.push([e,t]),this;i=this.__data__=new oe(r)}return i.set(e,t),this};var ye=V?A(V,Object):function(){return[]},be=function(e){return x.call(e)};function ge(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||d.test(e))&&e>-1&&e%1==0&&e<t}function ve(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||O)}function we(e){if(null!=e){try{return D.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ee(e,t){return e===t||e!=e&&t!=t}(B&&"[object DataView]"!=be(new B(new ArrayBuffer(1)))||Y&&be(new Y)!=o||q&&"[object Promise]"!=be(q.resolve())||H&&be(new H)!=a||X&&"[object WeakMap]"!=be(new X))&&(be=function(e){var t=x.call(e),i="[object Object]"==t?e.constructor:void 0,r=i?we(i):void 0;if(r)switch(r){case Q:return"[object DataView]";case J:return o;case Z:return"[object Promise]";case ee:return a;case te:return"[object WeakMap]"}return t});var Ae=Array.isArray;function Re(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!Ie(e)}var Se=z||function(){return!1};function Ie(e){var t=Ne(e)?x.call(e):"";return t==n||t==s}function Ne(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Oe(e){return Re(e)?le(e):function(e){if(!ve(e))return W(e);var t=[];for(var i in Object(e))$.call(e,i)&&"constructor"!=i&&t.push(i);return t}(e)}e.exports=function(e){return ue(e,!0,!0)}}));function x(e,t,i){t.getters?a("model/no-name-conflict","Name conflict: property getters already exists"):t.getters={};const r={};for(let s in i){let o=i[s];r[s]=()=>o.apply(t,e),Object.defineProperty(t.getters,s,{get:()=>n[s],enumerable:!0})}const n=new S({computed:r});return n}function M(e,t,i,r){for(let n in i){let s=i[n];if(r&&delete t[n],Object.prototype.hasOwnProperty.call(t,n)){a("model/no-name-conflict",`Name conflict: action "${n}" has same name as another method or property "${n}" in ${e.$model.name}`)}else Object.defineProperty(t,n,{value:(...i)=>(e.$modelsGetter&&(e.$models=e.$modelsGetter()),s.apply(t,[e,...i])),enumerable:!0})}}function L(e){return e&&"object"==typeof e&&!Array.isArray(e)}function P(e,t){return t.split(".").reduce((e,t)=>e[t]||{},e)}function k(e,t){const i=(""+t).split("."),r=i.pop();return i.reduce((e,t)=>e[t]||{},e)[r]}function G(e,t,i=!0){let r=i?Object.assign({},e):{};for(let n in t){let s=null,o=null;e&&(s=L(e[n])),t&&(o=L(t[n])),s&&o?G(e[n],t[n],i):S.set(e,n,t[n]),delete r[n]}for(let t in r)c("deep-merge","Deleting <",t,">"),S.delete(e,t);return r}function U(e,t,i){const r=(""+t).split("."),n=r.pop(),s=r.reduce((e,t)=>(t in e||S.set(e,t,{}),e[t]),e);if(n in s){if(c("deep-merge","Existing data found -> Performing deep merge at '",n,"' of target",s,"with source",i),".value"in i&&null===i[".value"])return c("deep-merge","New data is null, deleting node at <",n,">"),void S.delete(s,n);G(s[n],i,!0)}else S.set(s,n,i);return s[n]}const F=new WeakMap,C=new WeakMap,V=["ServerTimestamp","CurrentTimestamp","InitialTimestamp"];class GenericModel{constructor(e,t,i){this.$ready=!1,this.$promise=Promise.resolve(),this.$state={},this.$dirty={},this.$invalid={},this.$id=null,this.$idx=null,this.$noaccess=null,this._store_name=i,this._validation_behaviour="WARNING",S.observable(this.$state)}_update_data(e,t,i=!1){if(this.$state=e,i)for(var r in e)this.$dirty[r]=!0}clone(){const e=Object.assign(Object.create(Object.getPrototypeOf(this)),this);return e.$state=$(e.$state),e.$dirty=$(e.$dirty),e.$invalid=$(e.$invalid),e._autogenerate_props(this.$model.modelDefinition.schema.fields,e.$state,!1),e._set_generic_store(this.$model),F.set(e,this.$vm),e}setValidationBehaviour(e){["ERROR","WARNING","ELEMENT_VALIDATION","NONE"].includes(e)&&(this._validation_behaviour=e)}_update_field(e,t,i){let r=this._validation_behaviour||"WARNING";const n=i.is_nested?()=>function(e,t,i){const r=(""+t).split("."),n=r.pop(),s=r.reduce((e,t)=>(t in e||S.set(e,t,{}),e[t]),e);return S.set(s,n,i),s[n]}(this.$state,e,t):()=>S.set(this.$state,e,t);if(p.isMoment(t))return p.isValidDate(t)||a("model/invalid-moment","Got invalid (enhanced) moment object",t,"for prop",e),t=t.toRealtimeDB(),delete this.$invalid[e],this.$dirty[e]=!0,void n();if(!i.validator)return n(),void(this.$dirty[e]=!0);if(i.validator(t))delete this.$invalid[e],this.$dirty[e]=!0,n();else{if(this.$invalid[e]=!0,this.$dirty[e]=!0,n(),"ERROR"===r)throw new Error(`Validation failed for field '${e}' with value ${t}.`);"WARNING"===r&&a("model/client-validation-failed",`Validation failed for field '${e}' with value ${t}.`)}}_on_remove(){this.$deleted=!0}get $isValid(){return 0===Object.keys(this.$invalid).length}get $key(){return"KEY-"+this._store_name+"-"+this.$id}get $vm(){return F.get(this)}get $model(){return C.get(this)}get $exists(){return!1!==this.$state[".exists"]}_autogenerate_props(e,t,i=!1){Array.isArray(e)||(e=Object.keys(e).map(t=>({model:t,...e[t]}))),e.forEach(e=>{let r=e.model;if(t&&r in t&&(this.$state[r]=t[r]),i&&(this.$dirty[r]=!0),Object.prototype.hasOwnProperty.call(this,r))return void a("model/no-name-conflict",`Name conflict: property "${r}" has same name as global action/global getter "${r}" in ${this._store_name}`);let n=()=>{},s="";if(r.includes("/")||r.includes(".")){s=r.replace(/\//g,".");let t=s.split("."),i=t.pop();t=t.join("."),n=()=>P(this.$state,t)[i],e.is_nested=!0}else s=r,n=()=>this.$state[r],e.is_nested=!1;if(e.type){const t=(e,t,i,n)=>{if(0===e||null===e)return e;if(p.isMoment(e))throw new Error("Assigning moment objects directly to property is not allowed.");return isFinite(e)&&e>i&&e<n?t(e):void 0===e?t(NaN):(a("model/invalid-timestamp-from-server","Schema defined",r,"as Timestamp, but got invalid data:",e),p(e))};let i=n;"Timestamp"===e.type?n=()=>t(i(),p.fromRealtimeDB,2e8,3e10):V.includes(e.type)?n=()=>t(i(),p.fromRealtimeServerTime,2e11,3e13):e.type.includes("Timestamp")&&a("model/unknown-timestamp-type","Found validation type that contains 'Timestamp' but is not recognized.",e.type)}Object.defineProperty(this,s,{set:t=>this._update_field(s,t,e),get:n})})}_decorate_actions(e,t){if(!e)return;M({$instance:this,$model:t.model,$models:t.models},this,e,!1)}_decorate_getters(e,t){if(!e)return;for(let t in e)Object.prototype.hasOwnProperty.call(this,t)&&(a("model/no-name-conflict",`Name conflict: getter "${t}" has same name as property/custom action/global action/global getter "${t}" in ${this._store_name}`),delete e[t]);let i=x([this,t.model,t.models],this,e);F.set(this,i)}_set_generic_store(e){C.set(this,e)}write(){l("model","Writing $dirty fields",JSON.stringify(this.$dirty));let e={};for(let t in this.$dirty){let i,r;t.includes(".")?(r=t.replace(/\./g,"/"),i=k(this.$state,t)):(r=t,i=this.$state[t]),void 0!==i?e[r]=i:a("model/writing-undefined","Trying to write undefined for prop",t)}let t=this.$model;if(!t)throw new Error("Model reference not set with _set_generic_store");let i=!0,r=this.$id;return r||(r=t._get_uid(),i=!1),t.modelDefinition&&t.modelDefinition.schema?t._validate_schema(e,i):a("model/no-schema","No schema found to validate input"),t.update(r,e).then(()=>(this.$id=r,this.$dirty={},r))}_get_model_for_write(){if(!this.$id)throw new Error("Write operations are not allowed for new models.");let e=this.$model;if(!e)throw new Error("Model reference not set with _set_generic_store");return e}update(e){return this._get_model_for_write().update(this.$id,e).then(()=>{for(var t in e)delete this.$dirty[t];return this.$id})}remove(e=null){let t=this._get_model_for_write();return null==e&&(e=t.defaultDeleteMode===v.SOFT),t.remove(this.$id,e).then(()=>{e&&delete this.$dirty.deleted})}restore(){return this._get_model_for_write().restore(this.$id).then(()=>{delete this.$dirty.deleted})}reset(){}}function z(e,t){return e.sortidx<t.sortidx?-1:e.sortidx>t.sortidx?1:0}function W(e){let t=null;return"-"===e[0]?(e=e.slice(1),t=(t,i)=>t[e]<i[e]?1:t[e]>i[e]?-1:0):t=(t,i)=>t[e]<i[e]?-1:t[e]>i[e]?1:0,t}const B=new WeakMap;class GenericList{constructor(e){this.items={},this.$readyAll=!1,this.$readySome=!1,this.$promise=Promise.resolve(),this.$numReady=0,this.$noaccess=null,this.$numChildren=0,this._store_name=e,this._unwatch=null}_clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}_add_child(e,t){this.$readySome=!0,S.set(this.items,e,t),this.$numChildren+=1,this.items[e].$idx=this.$numChildren}_rem_child(e){e in this.items&&this.items[e]._on_remove(),S.delete(this.items,e),this.$numChildren-=1}get $vm(){return B.get(this)}_decorate_actions(e,t){if(!e)return;M({$instance:this,$model:t.model,$models:t.models},this,e,!1)}_decorate_getters(e,t){if(!e)return;for(let t in e)Object.prototype.hasOwnProperty.call(this,t)&&(a("model/no-name-conflict",`Name conflict: list getter "${t}" has same name as existing property getter "${t}" in ${this._store_name}`),delete e[t]);let i=x([this,t.model,t.models],this,e);B.set(this,i)}getItemByIdx(e){for(let t in this.items)if(this.items[t].$idx===e)return this.items[t];return null}asArraySorted(){let e=this._clone();return e.items=this.itemsAsArray(),e.items.sort(z),e}asArraySortedBy(e){let t=this._clone();return t.items=this.itemsAsArray(),t.items.sort(W(e)),t}asArrayFilteredBy(e,t){let i=this._clone();return i.items=this.itemsAsArray(),i.items=i.items.filter(i=>i[e]===t),i}itemsAsArray(){return Array.isArray(this.items)?this.items:Object.keys(this.items).map(e=>this.items[e])}get itemsSorted(){return this.itemsAsArray().sort(z)}itemsAsArrayWithoutDeleted(e){return this.itemsAsArray().filter(e=>!1===e.deleted||void 0===e.deleted).sort(e?W(e):z)}itemsAsArrayOnlyDeleted(e){return this.itemsAsArray().filter(e=>!0===e.deleted).sort(e?W(e):z)}get $idList(){return Object.keys(this.items)}reset(){this._unwatch&&(l("collection","Found local un-watcher in",this._store_name),this._unwatch())}}function Y(e){var t=e[e.length-1];return e.pop(),e=e.length>1?Y(e):e[0],function(...i){var r=e(...i),n=t(...i);return Object.assign(r||{},n)}}function q(){var e,t,i=new Promise((i,r)=>{e=i,t=r});return i.resolve=e,i.reject=t,i}let H=Array.prototype;function X(e,t){return e.filter(e=>t.indexOf(e)<0)}Object.defineProperty(H,"clone",{value:function(){return this.slice(0)},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(H,"move",{value:function(e,t){this.splice(t,0,this.splice(e,1)[0])},enumerable:!1,configurable:!0,writable:!0});const K=(e,...t)=>c("store/subscurbe/query",`[${e}]`,...t),Q=(e,...t)=>c("store/subscribe",`[${e}]`,...t),J=(e,...t)=>c("store/subscribe/details",`[${e}]`,...t),Z=(e,...t)=>c("store/subscribe/init",`[${e}]`,...t),ee=(e,...t)=>c("store/unsubscribe",`[${e}]`,...t),te=new WeakMap,ie=new Map,re=new Map,ne=new Map;"false"===String(process.env.VUE_APP_PRODUCTION)&&(window.helioRxDev=window.helioRxDev||{},window.helioRxDev._resultInstanceCache=re,window.helioRxDev._resultListCache=ne,window.helioRxDev._autoUnsubscribeMap=ie);var se={_read_mixin_init(){if(J(this.name,"[GENS:LOADER] init"),this.modelDefinition&&this.modelDefinition.staticGetters){const e=[this,N];this._vm=x(e,this,this.modelDefinition.staticGetters)}},get subscriptions(){return te.get(this)},_bind_rtdb({key:e,ref:t,ops:i,bindAsArray:r}){let n=this._last_caller||null;if(this.autoUnsubscribe&&n){let t=()=>(this._unbind_rtdb(e),{[e]:!0}),i=ie.get(n.uid);i&&(t=Y([t,i])),ie.set(n._uid,t),n.$once("hook:beforeDestroy",()=>{this._clean_up_refs(n)})}let s=te.get(this);return s||(s=Object.create(null),te.set(this,s)),e in s&&this._unbind_rtdb(e),new Promise((n,o)=>{s[e]=r?function({collection:e,ops:t,resolve:i,reject:r}){const{target:n}=t.init();e.once("value",e=>{t.once(n,e.val(),e.exists()),i()},e=>{e&&r(e)});const s=e.on("child_added",(e,i)=>{t.add(n,e.key,e.val())},r),o=e.on("child_removed",e=>{t.remove(n,e.key)},r),a=e.on("child_changed",e=>{t.set(n,e.key,e.val())},r),l=e.on("child_moved",(e,t)=>{},r);return()=>{e.off("child_added",s),e.off("child_changed",a),e.off("child_removed",o),e.off("child_moved",l)}}({key:e,collection:t,ops:i,resolve:n,reject:o}):function({document:e,ops:t,resolve:i,reject:r}){const{target:n}=t.init(),s=e.on("value",e=>{let r=e.val();e.exists()||(r={".exists":!1}),t.set(n,r),i(r)},e=>{e&&r(e)});return()=>{e.off("value",s)}}({key:e,document:t,ops:i,resolve:n,reject:o})})},_clean_up_refs(e){let t=ie.get(e._uid),i=e.$options.name||e.$options._componentTag;if(t){let r=t();l("store/unsubscribe/auto",`%cIt seems that the VueComponent "${i}" (${e.$vnode.tag}), \n`+"accessed this.$models and created a subscriptions. The components \n"+`just got destroyed and so did it's subscription to ${JSON.stringify(Object.keys(r))}.`,"color: green")}else l("store/unsubscribe/auto",`%cIt seems that the VueComponent "${i}" (${e.$vnode.tag}), \n`+"accessed this.$models, but it either didn't create any subscriptions or \nthe subscription was already removed. The component just got destroyed \nso there is nothing to clean up.","color: darkgoldenrod");ie.delete(e._uid)},_fetch_rtdb:({key:e,ref:t,ops:i,bindAsArray:r})=>new Promise((n,s)=>{r?function({collection:e,ops:t,resolve:i,reject:r}){const{target:n}=t.init();e.once("value",e=>{let r=e.val();t.once(n,r,e.exists()),i(r)},e=>{e&&r(e)})}({key:e,collection:t,ops:i,resolve:n,reject:s}):function({document:e,ops:t,resolve:i,reject:r}){const{target:n}=t.init();e.once("value",e=>{let r=e.val();e.exists()||(r={".exists":!1}),t.set(n,r),i(r)},e=>{e&&r(e)})}({key:e,document:t,ops:i,resolve:n,reject:s})}),_unbind_rtdb({key:e}){const t=te.get(this);t&&t[e]&&(t[e](),delete t[e])},_infer_local_path_from_ref:e=>e.path.toString().split("/").filter(e=>e).join("."),unsync(e=null,{clean_up:t=!1}={}){J(this.name,"[GENS] unsync",e,t);let i=null!==e?this.global_store_path_array[e]:this.global_store_path;if(i&&this._unbind_rtdb({key:i}),null!==e&&!(e in this.global_store_path_array)){if(this.isSuffixed)throw new Error("Unsync with id for data retrieved via subscribeList() is not supported.");i=this.global_store_path+"."+e}if(t){if(ee(this.name,"unsync: clean up state. id:",e,"path:",i),null!==e&&ne.has(this.path)){ne.get(this.path)._rem_child(e)}R.commit("heliosrx/UNSET_VALUE",{path:i},{root:!0})}},unsyncAll({clean_up:e=!1}={}){if(J(this.name,"[GENS] unsyncAll",e),te){if(e&&ne.has(this.path)){let e=ne.get(this.path);e.$idList.forEach(t=>e._rem_child(t)),e.reset()}Object.keys(te).forEach(t=>{this._unbind_rtdb({key:t}),e&&R.commit("heliosrx/UNSET_VALUE",{path:t},{root:!0})})}},_fetch_individual(e,{overwriteKey:t=!1,customOps:i={}}={}){return this._sync_individual(e,{overwriteKey:t,customOps:i,fetchOnce:!0})},_fetch_list({overwriteKey:e=!1,customOps:t={},customRef:i=null}={}){return this._sync_list({overwriteKey:e,customOps:t,customRef:i,fetchOnce:!0})},_sync_individual(e,{overwriteKey:t=!1,fetchOnce:i=!1,customOps:r={}}={}){this.isSuffixed||i||a("read/sync-individial-but-list-supported","Syncing individually in "+this.name+", even though list would be supported");const n=this.childRef(e),s="res."+this._infer_local_path_from_ref(n);this.global_store_path_array[e]=s,Q(this.name,"_sync_individual:",this.name,s,t,i),J(this.name,"[GENS] - sync ref",n.path.toString()),J(this.name,"[GENS] - sync key",s),J(this.name,"[GENS] - sync target",this.global_store_path_array[e]);let o={init:()=>{let t={};return J(this.name,"[OPS:INIT (individual)]",t),R.commit("heliosrx/INIT_VALUE",{path:this.global_store_path_array[e],data:t},{root:!0}),{target:t}},set:(e,t)=>{J(this.name,"[OPS:SET (individual)]",e,null),R.commit("heliosrx/SET",{target:e,data:t},{root:!0})}};return i&&(o={init:()=>{Z(this.name,"[OPS:INIT] (fetch, individial)");return{target:{}}},set:(e,t)=>{Z(this.name,"[OPS:SET] (fetch, individial)",e,null)}}),Object.keys(r).forEach(e=>{o[e]=Y([o[e],r[e]])}),i?this._fetch_rtdb({key:s,ref:n,ops:o,bindAsArray:!1}):this._bind_rtdb({key:s,ref:n,ops:o,bindAsArray:!1})},_sync_list({overwriteKey:e=!1,fetchOnce:t=!1,customOps:i={},customRef:r=null}={}){if(this.isSuffixed)throw new Error("Suffixed store does not support bind to array");const n=r||this.parentRef,s="res."+(e||this._infer_local_path_from_ref(n));Q(this.name,"sync:",this.name,s,e,t),J(this.name,"[GENS] - ref",this.parentRef),J(this.name,"[GENS] - key",s),this.global_store_path=s;const o={root:!0};let a={init:()=>{J(this.name,"[OPS:INIT]",this.global_store_path,R.state);let e={},t=P(R.state,this.global_store_path);return Object.keys(t).length>0&&(J(this.name,"[OPS:INIT] existing_data",t),e=t),J(this.name,"[OPS:INIT] data",null),R.commit("heliosrx/INIT_VALUE",{path:this.global_store_path,data:e},o),{target:e}},add:(e,t,i)=>{J(this.name,"[OPS:ADD]",e,t,i,null),R.commit("heliosrx/ARRAY_ADD",{target:e,newId:t,data:i},o)},remove:(e,t)=>{let i=e[t],r=this._match_all_existing_synced_queries(this.path);ee(this.name,"[OPS:REMOVE]",e,t),ee(this.name,"entry_name",this.path),ee(this.name,"deleted_item",i),ee(this.name,"_match_existing_synced_nodes",r);for(let e in r){let n=r[e].query;if(this._item_matches_query(n,i))return void ee(this.name,"ITEM STILL IN USE",t,i)}R.commit("heliosrx/ARRAY_REMOVE",{target:e,oldId:t},o)},set:(e,t,i)=>{J(this.name,"[OPS:SET]",e,t,i),R.commit("heliosrx/ARRAY_SET",{target:e,currentId:t,data:i},o)},once:(e,t,i)=>{J("[OPS:ONCE]",t,i)}};return t&&(a={init:()=>{Z(this.name,"[OPS:INIT] (fetch)",s);return{target:{}}},once:(e,t,i)=>{Z(this.name,"[OPS:ONCE] (fetch)",t,i)}}),Object.keys(i).forEach(e=>{a[e]=Y([a[e],i[e]])}),J(this.name,"[GENS] - ops",a),J(this.name,"[GENS] - payload",{key:s,ref:n,ops:a,bindAsArray:!0}),t?this._fetch_rtdb({key:s,ref:n,ops:a,bindAsArray:!0}):this._bind_rtdb({key:s,ref:n,ops:a,bindAsArray:!0})},_item_matches_query:(e,t)=>!0,_create_context(){return{model:this,models:N}},_match_all_existing_synced_queries(e,t=!0){e.includes("#")&&(e=e.split("#").shift());let i=[];for(var r in R.state.sync){let n=r.split("#").shift();if(e.startsWith(n)){let e=R.state.sync[r];if(!t||"Ready"!==e.status&&"Loading"!==e.status)continue;i.push({path:r,path_without_query:n,...e})}}return i},_match_existing_synced_nodes(e,t=!1){for(var i in e.includes("#")&&(e=e.split("#").shift()),R.state.sync){let r=i;if(i.includes("#")){let t=i.split("#").shift();e.startsWith(t)&&a("read/sync-existing-query-path","You're trying to sync a path that has already been synced by a query. This is not supported.","requested_path",e,"existing_path",i)}if(t&&i.includes("{id}")&&(i=i.replace("{id}","")),e.startsWith(i)&&("Ready"===R.state.sync[r].status||"Loading"===R.state.sync[r].status))return a("read/sync-subset-data",this.name,"Found node of higher hierarchy that is already syncing:",i,"vs.",e),r}return!1},_get_sync_state:e=>(R.state.sync[e]||{}).status||null,getList(e,{noReactiveGetter:t=!1}={}){return Q(this.name,"getList",e||"*"),this.subscribeList(e,{noSync:!0,createModelFromExistingCache:!0,noReactiveGetter:t})},getNode(e,{noReactiveGetter:t=!1}={}){if(Q(this.name,"getNode",e),!e)throw new Error("getNode: got invalid id: "+e);return this.subscribeNode(e,{noSync:!0,createModelFromExistingCache:!0,noReactiveGetter:t})},subscribeList(e=[],{noSync:t=!1,noReactiveGetter:i=!1,createModelFromExistingCache:r=!1,queryParams:n=null}={}){let s=null,o="",d=this.path;if(n&&(s=this.buildQueryRef(n),o=this._query_hash(n),d=d+"#"+o,K(this.name,"QUERYHASH:"+d,"Using query hash in entry_name",d)),Q(this.name,"subscribeList",d),ne.get(d))return Q(this.name,"subscribeList - returning list cache"),ne.get(d);let u=R.getters.get_registry_entry(d);u&&Q(this.name,"subscribeList - WARN - found registry entry, but no local cache!");const h=this._match_existing_synced_nodes(d,!0);if(h){if(r){let e=this.getData();Q(this.name,"Found node in existing synced data making list model from existing data",e);let t=D.make_reactive_list(this.modelDefinition,e,this._create_context(),i);t.$promise=q();let r=this._get_sync_state(h);Q(this.name,"checking sync state - is data already fully synced?",r),"Ready"===r&&t.$promise.resolve(!0),ee(this.name,"[Watcher] Registering Watcher");let n=R.watch(e=>(ee(this.name,"[Watcher]  -- asking for value"),this.getData(null,!0)),(e,r)=>{if(ee(this.name,"[Watcher]  -- watcher triggered",e,r),null==e)return t.$idList.forEach(e=>{ee(this.name,"[Watcher]  -- ELIMINATIING LIST",e),t._rem_child(e)}),t.$numReady=!1,t.$readyAll=!1,t.$readySome=!1,void t.$promise.resolve(!0);let n=Object.keys(e),s=r?Object.keys(r):[],o=t.$idList;n.toString()===s.toString()&&ee(this.name,"[Watcher] Watcher values are the same? WHY? ",n,s);let l={removed:X(u=o,c=n),added:X(c,u)};var c,u;ee(this.name,"[Watcher] DIFF",l,n,o),l.removed.forEach(e=>{ee(this.name,"[Watcher]  -- REMOVED",e),t._rem_child(e),t.$numReady--}),l.added.forEach(e=>{ee(this.name,"[Watcher]  -- ADDED",e);let r=d.split("#").shift().replace(/\{id\}/g,e);re.has(r)&&a("common/common","A new item was added, but there already exists a model instance in the cache for this item. This means the subscription management failed.");let n=this.getData(e),s=D.make_reactive_model(this.modelDefinition,n,this._create_context(),!1,i);s.$id=e,t._add_child(e,s),t.$numReady++,re.set(r,s)}),t.$promise.resolve(!0)});return t._unwatch=n,ne.set(d,t),t}a("read/sync-subset-data","You're trying to sync data, that is already synced by a node higher up in the hierarchy. This will result in undefined behaviour. Try using getList() or getNode() instead! Sync path:",d)}if(this._match_existing_synced_nodes(d)===d)throw c("store/subscribe",">>>",d,ne,re),new Error("Exact path found, but no cache hit. This should never happen");if(t)return Q(this.name,"subscribeList - No Sync, returning"),a("read/accessing-unsynced-data","You're trying to fetch data at "+d+" that has not been synced yet."),null;K(this.name,null,"*new* subscribeList",d),u={query:n,status:"Loading"},R.commit("ADD_ENTRY",{name:d,data:u});let f=D.make_reactive_list(this.modelDefinition,null,this._create_context());ne.set(d,f),f.$promise=q(),Q(this.name,"subscribeList - Created reactive list, made registry entry, started sync request for",u,f);const m={add:(e,t,r)=>{R.commit("SET_ENTRY_STATUS",{name:d,value:"Ready"}),Q(this.name,"subscribeList:add - Child ready",this.name,d,t);let n=d.split("#").shift().replace(/\{id\}/g,t);re.has(n)&&Q(this.name,"subscribeList:add - Reactive model already exists in instance cache"),t in f.items&&a("common/common","An existing item was added twice. This means the subscription management failed.");let s=re.has(n)?re.get(n):D.make_reactive_model(this.modelDefinition,r,this._create_context(),!1,i);s.$id=t,f._add_child(t,s),re.has(n)?(Q("subscribeList:add - Updating existing item (previously synced with subscribeNode) with",r),s._update_data(r)):re.set(n,s)},init:()=>(Q(this.name,"subscribeList:init"),{}),remove:(e,t)=>{ee(this.name,"subscribeList:remove",t),f._rem_child(t)},set:(e,t,i)=>{if(Q(this.name,"subscribeList:set",t,i),ne.get(d)&&t in ne.get(d).items){let e=ne.get(d).items[t],i=this.getData(t);e._update_data(i,this.modelDefinition.schema.fields),Q(this.name,"subscribeList:set [B] - updating model",i)}else Q(this.name,"subscribeList:set - WARNING - not found in cache!",t,ne.get(d))}};return this._sync_list({customOps:m,customRef:s}).then(()=>{f.$readyAll=!0,f.$promise.resolve(!0)}).catch(e=>{if("PERMISSION_DENIED"!==e.code)throw e;a("read/permission-denied",e.message),l("permission","======================================"),l("permission",`PERMISSION_DENIED [${this.name}.subscribeList()]`),l("permission","queryParams:",n),l("permission","======================================"),f.$readyAll=!0,f.$readySome=!0,f.$noaccess=!0,f.$promise.reject(e)}),f},subscribeNode(e,{noSync:t=!1,noReactiveGetter:i=!1,createModelFromExistingCache:r=!1}={}){if(!e)throw new Error("subscribeNode: got invalid id: ");let n=this.previewPath(e),s=this.path;if(Q(this.name,"subscribeNode",n),ne.get(s)&&e in ne.get(s).items)return Q(this.name,"subscribeNode - returning from list cache"),ne.get(s).items[e];if(re.has(n))return Q(this.name,"subscribeNode - returning from instance cache"),re.get(n);if(this._match_existing_synced_nodes(s)&&K(this.name,"======================================= (FIXME)",{entry_name_child:n},{entry_name_list:s},{"has:node":re.has(n)},{"get:list":re.get(s)}),this._match_existing_synced_nodes(n)){if(r){let t=this.getData(e);Q(this.name,"Found node in existing synced data making model from existing data",t);let r=D.make_reactive_model(this.modelDefinition,t,this._create_context(),!1,i);return r.$id=e,r.$ready=!0,re.set(n,r),Q(this.name,"made model",r),r}a("read/sync-subset-data","You're trying to sync data, that is already synced by a node higher up in the hierarchy. This will result in undefined behaviour. Try using getNode() instead! Sync path:",n)}if(this._match_existing_synced_nodes(n)===n)throw c("store/subscribe",">>>",n,ne,re),new Error("Exact path found, but no cache hit. This should never happen");if(t)return null;K(this.name,e,"*new* subscribeNode",n);let o=D.make_reactive_model(this.modelDefinition,null,this._create_context(),!1,i);o.$id=e,o.$promise=q(),re.set(n,o);let d={id:e,status:"Loading"};R.commit("ADD_ENTRY",{name:n,data:d}),Q(this.name,"subscribeNode - Made registry entry and started at",n,d);const u={init:e=>(Q(this.name,"subscribeNode:init",e),{}),set:(e,t)=>{Q(this.name,"subscribeNode:set",e,t)}};return this._sync_individual(e,{customOps:u}).then(t=>{let i=this.getData(e);Q(this.name,"subscribeNode - data ready",n,t,i),void 0!==i?(o._update_data(i,this.modelDefinition.schema.fields),o.$ready=!0,o.$noaccess=!1,R.commit("SET_ENTRY_STATUS",{name:n,value:"Ready"}),Q(this.name,"subscribeNode - created reactive model",o),o.$promise.resolve(!0)):a("common/common",this.name,"subscribeNode - subscribeList took over, while waiting for _sync_individual. subscribeList will handle instance now.")}).catch(t=>{if("PERMISSION_DENIED"!==t.code)throw t;{a("read/permission-denied",t.message),l("permission","======================================"),l("permission",`PERMISSION_DENIED [${this.name}.subscribeNode( ${e} )]`),l("permission","======================================"),R.commit("SET_ENTRY_STATUS",{name:n,value:"NoAccess"});let i=this.getData(e);i[".noaccess"]=!0,o._update_data(i,this.modelDefinition.schema.fields),o.$ready=!0,o.$noaccess=!0,o.$promise.reject(t)}}),o},buildQueryRef({key:e,value:t,limit:i,startAt:r,endAt:n}){let s=this.parentRef;return s="*"===e?s.orderByValue():void 0===e?s.orderByKey():s.orderByChild(e),void 0!==t&&(s=s.equalTo(t)),void 0!==r&&(s=s.startAt(r)),void 0!==n&&(s=s.endAt(n)),void 0!==i&&(s=i>0?s.limitToFirst(i):s.limitToLast(-i)),s},_query_hash:e=>[e.key,e.value,e.limit,e.startAt,e.endAt].join("_"),subscribeQuery(e,t={}){return this.subscribeList(null,{...t,queryParams:e})},fetchNode(e,{noReactiveGetter:t=!1}={}){let i=D.make_reactive_model(this.modelDefinition,null,this._create_context(),!1,t);i.$id=e,i.$promise=q();const r={init:()=>(Z(this.name,"fetchNode:init"),{}),set:(e,t)=>{Z(this.name,"fetchNode:set",e,t)}};return this._fetch_individual(e,{customOps:r}).then(e=>{Z(this.name,"fetchNode - data ready",e),i._update_data(e,this.modelDefinition.schema.fields),i.$ready=!0,i.$promise.resolve(!0)}),i},fetchList({noReactiveGetter:e=!1,queryParams:t=null}={}){let i=t?this.buildQueryRef(t):null,r=D.make_reactive_list(this.modelDefinition,null,this._create_context(),e);r.$promise=q();const n={init:()=>(Z(this.name,"fetchList:init"),{}),once:(e,t,i)=>{Z(this.name,"fetchList:once",t)}};return this._fetch_list({customOps:n,customRef:i}).then(t=>{Z(this.name,"fetchList:resolve",t),Object.keys(t||[]).forEach(i=>{let n=t[i],s=D.make_reactive_model(this.modelDefinition,n,this._create_context(),!1,e);s.$id=i,r._add_child(i,s),r.$numReady++}),r.$readyAll=!0,r.$promise.resolve(!0)}),r},fetchQuery(e,t){return this.fetchList({...t,queryParams:e})},getRegistryState:()=>R.state,getAllSyncedPaths(){let e={};return Object.keys(R.state.sync).forEach(t=>{e[t]=R.state.sync[t].status}),e},getData(e=null,t=!1){let i="";if(this.isSuffixed||e){if(!e)throw new Error("getData: id required for suffixed stores");i=this.path.replace(/\{id\}/g,e)}else i=this.path.split("{id}").shift();let r="res."+i.split("/").filter(e=>e).join(".");return R.state.initialized?t?P(R.state,r):(n=R.state,r.split(".").reduce((e,t)=>e[t],n)):null;var n},resetGlobalInstanceCache(){try{re.forEach(e=>{e.reset()}),ne.forEach(e=>{e.reset()})}catch(e){a("common/common","Reseting instances failed",e)}re.clear(),ne.clear()}},oe=r((function(e,t){var r="[object Arguments]",n="[object Map]",s="[object Object]",o="[object Set]",a=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,c={};c["[object Float32Array]"]=c["[object Float64Array]"]=c["[object Int8Array]"]=c["[object Int16Array]"]=c["[object Int32Array]"]=c["[object Uint8Array]"]=c["[object Uint8ClampedArray]"]=c["[object Uint16Array]"]=c["[object Uint32Array]"]=!0,c[r]=c["[object Array]"]=c["[object ArrayBuffer]"]=c["[object Boolean]"]=c["[object DataView]"]=c["[object Date]"]=c["[object Error]"]=c["[object Function]"]=c[n]=c["[object Number]"]=c[s]=c["[object RegExp]"]=c[o]=c["[object String]"]=c["[object WeakMap]"]=!1;var d="object"==typeof i&&i&&i.Object===Object&&i,u="object"==typeof self&&self&&self.Object===Object&&self,h=d||u||Function("return this")(),f=t&&!t.nodeType&&t,m=f&&e&&!e.nodeType&&e,_=m&&m.exports===f,p=_&&d.process,y=function(){try{return p&&p.binding&&p.binding("util")}catch(e){}}(),b=y&&y.isTypedArray;function g(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}function v(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function w(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var E,A,R,S=Array.prototype,I=Function.prototype,N=Object.prototype,O=h["__core-js_shared__"],j=I.toString,T=N.hasOwnProperty,D=(E=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"",$=N.toString,x=RegExp("^"+j.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),M=_?h.Buffer:void 0,L=h.Symbol,P=h.Uint8Array,k=N.propertyIsEnumerable,G=S.splice,U=L?L.toStringTag:void 0,F=Object.getOwnPropertySymbols,C=M?M.isBuffer:void 0,V=(A=Object.keys,R=Object,function(e){return A(R(e))}),z=ye(h,"DataView"),W=ye(h,"Map"),B=ye(h,"Promise"),Y=ye(h,"Set"),q=ye(h,"WeakMap"),H=ye(Object,"create"),X=we(z),K=we(W),Q=we(B),J=we(Y),Z=we(q),ee=L?L.prototype:void 0,te=ee?ee.valueOf:void 0;function ie(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function re(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ne(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function se(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ne;++t<i;)this.add(e[t])}function oe(e){var t=this.__data__=new re(e);this.size=t.size}function ae(e,t){var i=Re(e),r=!i&&Ae(e),n=!i&&!r&&Se(e),s=!i&&!r&&!n&&Te(e),o=i||r||n||s,a=o?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],l=a.length;for(var c in e)!t&&!T.call(e,c)||o&&("length"==c||n&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ve(c,l))||a.push(c);return a}function le(e,t){for(var i=e.length;i--;)if(Ee(e[i][0],t))return i;return-1}function ce(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":U&&U in Object(e)?function(e){var t=T.call(e,U),i=e[U];try{e[U]=void 0;var r=!0}catch(e){}var n=$.call(e);r&&(t?e[U]=i:delete e[U]);return n}(e):function(e){return $.call(e)}(e)}function de(e){return je(e)&&ce(e)==r}function ue(e,t,i,a,l){return e===t||(null==e||null==t||!je(e)&&!je(t)?e!=e&&t!=t:function(e,t,i,a,l,c){var d=Re(e),u=Re(t),h=d?"[object Array]":ge(e),f=u?"[object Array]":ge(t),m=(h=h==r?s:h)==s,_=(f=f==r?s:f)==s,p=h==f;if(p&&Se(e)){if(!Se(t))return!1;d=!0,m=!1}if(p&&!m)return c||(c=new oe),d||Te(e)?me(e,t,i,a,l,c):function(e,t,i,r,s,a,l){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new P(e),new P(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ee(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case n:var c=v;case o:var d=1&r;if(c||(c=w),e.size!=t.size&&!d)return!1;var u=l.get(e);if(u)return u==t;r|=2,l.set(e,t);var h=me(c(e),c(t),r,s,a,l);return l.delete(e),h;case"[object Symbol]":if(te)return te.call(e)==te.call(t)}return!1}(e,t,h,i,a,l,c);if(!(1&i)){var y=m&&T.call(e,"__wrapped__"),b=_&&T.call(t,"__wrapped__");if(y||b){var g=y?e.value():e,E=b?t.value():t;return c||(c=new oe),l(g,E,i,a,c)}}if(!p)return!1;return c||(c=new oe),function(e,t,i,r,n,s){var o=1&i,a=_e(e),l=a.length,c=_e(t).length;if(l!=c&&!o)return!1;var d=l;for(;d--;){var u=a[d];if(!(o?u in t:T.call(t,u)))return!1}var h=s.get(e);if(h&&s.get(t))return h==t;var f=!0;s.set(e,t),s.set(t,e);var m=o;for(;++d<l;){u=a[d];var _=e[u],p=t[u];if(r)var y=o?r(p,_,u,t,e,s):r(_,p,u,e,t,s);if(!(void 0===y?_===p||n(_,p,i,r,s):y)){f=!1;break}m||(m="constructor"==u)}if(f&&!m){var b=e.constructor,g=t.constructor;b!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g)&&(f=!1)}return s.delete(e),s.delete(t),f}(e,t,i,a,l,c)}(e,t,i,a,ue,l))}function he(e){return!(!Oe(e)||function(e){return!!D&&D in e}(e))&&(Ie(e)?x:a).test(we(e))}function fe(e){if(!function(e){var t=e&&e.constructor,i="function"==typeof t&&t.prototype||N;return e===i}(e))return V(e);var t=[];for(var i in Object(e))T.call(e,i)&&"constructor"!=i&&t.push(i);return t}function me(e,t,i,r,n,s){var o=1&i,a=e.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(e);if(c&&s.get(t))return c==t;var d=-1,u=!0,h=2&i?new se:void 0;for(s.set(e,t),s.set(t,e);++d<a;){var f=e[d],m=t[d];if(r)var _=o?r(m,f,d,t,e,s):r(f,m,d,e,t,s);if(void 0!==_){if(_)continue;u=!1;break}if(h){if(!g(t,(function(e,t){if(o=t,!h.has(o)&&(f===e||n(f,e,i,r,s)))return h.push(t);var o}))){u=!1;break}}else if(f!==m&&!n(f,m,i,r,s)){u=!1;break}}return s.delete(e),s.delete(t),u}function _e(e){return function(e,t,i){var r=t(e);return Re(e)?r:function(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}(r,i(e))}(e,De,be)}function pe(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function ye(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return he(i)?i:void 0}ie.prototype.clear=function(){this.__data__=H?H(null):{},this.size=0},ie.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ie.prototype.get=function(e){var t=this.__data__;if(H){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return T.call(t,e)?t[e]:void 0},ie.prototype.has=function(e){var t=this.__data__;return H?void 0!==t[e]:T.call(t,e)},ie.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=H&&void 0===t?"__lodash_hash_undefined__":t,this},re.prototype.clear=function(){this.__data__=[],this.size=0},re.prototype.delete=function(e){var t=this.__data__,i=le(t,e);return!(i<0)&&(i==t.length-1?t.pop():G.call(t,i,1),--this.size,!0)},re.prototype.get=function(e){var t=this.__data__,i=le(t,e);return i<0?void 0:t[i][1]},re.prototype.has=function(e){return le(this.__data__,e)>-1},re.prototype.set=function(e,t){var i=this.__data__,r=le(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},ne.prototype.clear=function(){this.size=0,this.__data__={hash:new ie,map:new(W||re),string:new ie}},ne.prototype.delete=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t},ne.prototype.get=function(e){return pe(this,e).get(e)},ne.prototype.has=function(e){return pe(this,e).has(e)},ne.prototype.set=function(e,t){var i=pe(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},se.prototype.add=se.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},se.prototype.has=function(e){return this.__data__.has(e)},oe.prototype.clear=function(){this.__data__=new re,this.size=0},oe.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},oe.prototype.get=function(e){return this.__data__.get(e)},oe.prototype.has=function(e){return this.__data__.has(e)},oe.prototype.set=function(e,t){var i=this.__data__;if(i instanceof re){var r=i.__data__;if(!W||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new ne(r)}return i.set(e,t),this.size=i.size,this};var be=F?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,r=null==e?0:e.length,n=0,s=[];++i<r;){var o=e[i];t(o,i,e)&&(s[n++]=o)}return s}(F(e),(function(t){return k.call(e,t)})))}:function(){return[]},ge=ce;function ve(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function we(e){if(null!=e){try{return j.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ee(e,t){return e===t||e!=e&&t!=t}(z&&"[object DataView]"!=ge(new z(new ArrayBuffer(1)))||W&&ge(new W)!=n||B&&"[object Promise]"!=ge(B.resolve())||Y&&ge(new Y)!=o||q&&"[object WeakMap]"!=ge(new q))&&(ge=function(e){var t=ce(e),i=t==s?e.constructor:void 0,r=i?we(i):"";if(r)switch(r){case X:return"[object DataView]";case K:return n;case Q:return"[object Promise]";case J:return o;case Z:return"[object WeakMap]"}return t});var Ae=de(function(){return arguments}())?de:function(e){return je(e)&&T.call(e,"callee")&&!k.call(e,"callee")},Re=Array.isArray;var Se=C||function(){return!1};function Ie(e){if(!Oe(e))return!1;var t=ce(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ne(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Oe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function je(e){return null!=e&&"object"==typeof e}var Te=b?function(e){return function(t){return e(t)}}(b):function(e){return je(e)&&Ne(e.length)&&!!c[ce(e)]};function De(e){return null!=(t=e)&&Ne(t.length)&&!Ie(t)?ae(e):fe(e);var t}e.exports=function(e,t){return ue(e,t)}}));var ae={_write_mixin_init(e=!1){if(this.modelDefinition&&this.modelDefinition.staticActions){M({$model:this,$modelsGetter:()=>N},this,this.modelDefinition.staticActions,e)}},add(e,t,i){let r=null;if(t||(t=this._get_uid()),!t[".sv"]&&!this._validate_id(t))throw new Error("Got invalid id:"+t);let n=!0;return i&&i.directWrite&&(n=!1),this.modelDefinition?(n?this.modelDefinition.schema&&this.modelDefinition.schema.create?(this._check_required_create_arg(e),r=this.modelDefinition.schema.create(e,e,"REALTIMEDB")):(a("model/no-create-function","No create function found in type definition, using overwrite data as payload."),r=e):r=e,this.modelDefinition.schema?this._validate_schema(r,!1):a("model/no-schema","No schema found to validate input")):(a("model/no-schema","No type definition found, using UNVALIDATED overwrite data as payload."),r=e),this._convert_moment_objects(r),l("store-write","Creating at",this.previewPath(t),"with payload",r),this.isSuffixed?this.childRef(t).update(r).then(()=>t):this.parentRef.update({[t]:r}).then(()=>t)},update(e,t){if(!e||!t)throw new Error("Either id or data is missing.");if(!this._validate_id(e)){if(!(this.modelDefinition.schema||{}).unsafe_disable_validation)throw new Error("Got invalid id in update");a("model/invalid-id","Got invalid id <"+e+">, but validation is disabled.")}this.modelDefinition.schema?this._validate_schema(t,!0):a("model/no-schema","No schema found to validate input");let i=t;return this._convert_moment_objects(i),l("store-write","Updating at",this.previewPath(e),"with payload",i),this.childRef(e).update(i)},reorder(e,t={}){if(this.isSuffixed)throw new Error("Suffixed store does not support reorder");let i=t.overwriteSortIdxKey||"sortidx";if(e.length>0){let t=e[0],i=0;(d(t)||u(t))&&(e=e.map(e=>(i+=100,{id:e,sortidx:i}))),("$id"in t||"GenericModel"===t.constructor.name)&&(e=e.map(e=>(i+=100,{id:e.$id,sortidx:i})))}let r={};e.forEach(e=>{let t=e.sortidx;if(e.id=e.id||e.$id,"number"!=typeof t&&(t=parseFloat(t)),isNaN(t))throw new Error("Got invalid sortidx",t);if(!this._validate_id(e.id))throw new Error("Got invalid id",e.id);r[e.id]={[i]:t}});let n={};return Object.keys(r).forEach(e=>{let t=r[e];Object.keys(t).forEach(i=>{n[this.previewPath(e)+"/"+i]=t[i]})}),l("store-write","Updating at",this.previewPath(),"with payload",n),this.rootRef.update(n)},remove(e,t){if(t=void 0===t?this.defaultDeleteMode===v.SOFT:t,Array.isArray(e)){const i={};return e.forEach(e=>{if(!this._validate_id(e))throw new Error("Got invalid id in remove");t?i[e+"/deleted"]=!0:i[e]=null}),l("store-write","Batch deleting at",this.path,"with payload",i),this.parentRef.update(i)}if(!this._validate_id(e))throw new Error("Got invalid id in remove");return t?(l("store-write","Soft deleting at",this.path,"with",{deleted:!0}),this.update(e,{deleted:!0})):(l("store-write","Hard deleting at",this.path),this.childRef(e).remove())},restore(e){return this.update(e,{deleted:!1})},copy(e,t,i){return this.move(e,t,i,{keepOriginal:!0,keepId:!1})},move(e,t,i,{keepOriginal:r=!1,keepId:n=!0}={}){if(this.isSuffixed)throw new Error("Suffixed store does not support move");if(!this._validate_id(e))throw new Error("Got invalid id in remove");let s=Object.keys(t).sort(),o=Object.keys(i).sort();if(!oe(s,o))throw new Error("Context A and context B do not have equal keys");let a=Object.assign({},this.definedProps,t,{id:e}),c=Object.assign({},this.definedProps,i,{id:e});n||(c.id=this._get_uid());let d=this.templatePath.replace(/\*/,"{id}"),u=w(d,a),h=w(d,c),f=E(u);if(f.length>0)throw new Error("Not all template id's are defined. Required fields are "+f.join(", "));return this._db.ref(u).once("value").then(e=>e.val()).then(e=>{let t={[u]:null,[h]:e};return r&&(t={[h]:e}),l("store-write","Moving data from ",u,"to",h,"with payload",t),this.rootRef.update(t).then(()=>c.id)})},transaction(e,t,i,r=1){if(!this._validate_id(e))throw new Error("Got invalid id in remove");let n=this.childRef(e);if(t&&(this._validate_schema({[t]:1}),n=n.ref.child(t)),"string"==typeof i)switch(i){case"inc":i=e=>(e||0)+r;break;case"dec":i=e=>(e||0)-r}if("function"!=typeof i)throw new Error("Transacton must be a function");return l("store-write","Tranaction on",n.path.toString()),n.transaction(i).then(e=>e.committed?(l("store-write","Transacton successfully committed"),!0):(l("store-write","Transacton aborted"),!1))},new(){return D.make_reactive_model(this.modelDefinition,null,this._create_context(),!1)},newFromTemplate(e={},t=null){let i=this.empty(e,t),r=D.make_reactive_model(this.modelDefinition,e,this._create_context(),!1);return r._update_data(i,null,!0),r},newFromData(e={},t=!1){return D.make_reactive_model(this.modelDefinition,e,this._create_context(),!1)},empty(e={},t=null){if(!this.modelDefinition)return null;if(!this.modelDefinition.schema||!this.modelDefinition.schema.create)return null;this._check_required_create_arg(e);let i=this.modelDefinition.schema.create(e,t||e,"REALTIMEDB");return this.modelDefinition.schema?this._validate_schema(i,!1):a("model/no-schema","No schema found to validate input"),i},_convert_moment_objects(e){if("object"!=typeof e)throw c("moment","Got invalid payload in _convert_moment_objects",e,typeof e),new Error("Expected object, got "+e);for(let t in e)if(p.isMoment(e[t])){if(!e[t].toRealtimeDB)throw new Error("Moment object passed to add/update must be enhanced moment objects.");e[t]=e[t].toRealtimeDB()}else Array.isArray(e[t])?this._convert_moment_objects(e[t]):"object"==typeof e[t]&&this._convert_moment_objects(e[t])}};const le=require("slugid");let ce,de=null,ue=null,he=null,fe={userId:null};function me({Vue:e,firebase:t}){ce=e,fe=ce.observable(fe),D.configure({GenericModel:GenericModel,GenericList:GenericList}),he=t}const _e={isAbstract:!1,uidMethod:g.PUSHID,additionalProps:[],defaultDeleteMode:v.HARD,enableTypeValidation:!0,autoUnsubscribe:!0,isReadonly:!1,allowEmptySchema:!0};class GenericStore{constructor(e,t,i={}){if(i=Object.assign({},_e,i),t&&(t.abstract_store||i.isAbstract))this.isAbstract=!0,this.templatePath=e,this.modelDefinition=t,this.definedProps={},this.name="unnamed abstract";else{if(this.isAbstract=!1,this.name="unnamed",!e||e.length<2)throw new Error("Invalid template path:"+e);if("/"!==e[0])throw new Error("Template path has to start with /, got: "+e);if(1!==(e.match(/\*/g)||[]).length)throw new Error("Template path must contain exactly one *, got:"+e);this.isSuffixed=e.indexOf("*")!==e.length-1,"function"==typeof i.uidMethod?(this.uidMethod=g.CUSTOM,this.uidMethodCallback=i.uidMethod):this.uidMethod=i.uidMethod||g.PUSHID,this.additionalProps=i.additionalProps||[],this.defaultDeleteMode=i.defaultDeleteMode}this.enableTypeValidation=i.enableTypeValidation,this.autoUnsubscribe=i.autoUnsubscribe,this.allowEmptySchema=i.allowEmptySchema,this.isReadonly=i.isReadonly,this.templatePath=e,this.modelDefinition=t,this.definedProps={},this._localDB=null,this._clones=[],this.global_store_path_array=[],this.isSuffixed||(this.global_store_path=""),this.isAbstract?(Object.assign(this,{_read_mixin_init:se._read_mixin_init,_write_mixin_init:ae._write_mixin_init}),this._read_mixin_init(),this._write_mixin_init()):(Object.assign(this,se),this._read_mixin_init(),this.isReadonly||(Object.assign(this,ae),this._write_mixin_init()))}_clone(){const e=Object.getPrototypeOf(this),t=Object.create(e),i=Object.assign(t,this);return delete i.getters,delete i._vm,i._read_mixin_init(),this.isReadonly||i._write_mixin_init(!0),i._clones=[],this._clones.push(i),i}setName(e){this.name=e}generateId(){return this._get_uid()}_get_uid(){switch(this.uidMethod){case g.SLUGID:return le.nice();case g.PUSHID:return this.rootRef.push().key;case g.TIMESTAMP:return he.database.ServerValue.TIMESTAMP;case g.LOCAL_TIMESTAMP:return p.currentTime().unix();case g.DATE:return p.currentDate().format("DD-MM-YYYY");case g.OTHER_USER_ID:throw new Error("Please provide id through id override");case g.MY_USER_ID:if(!GenericStore.defaultUserId)throw new Error("User ID is not set, but a store uses USER_ID as key");return GenericStore.defaultUserId;case g.ARRAY:return 0;case g.EMAIL:throw new Error("Only email addresses allowed as key");case g.CUSTOM:{let e=this.uidMethodCallback(this.definedProps);if(!e)throw new Error("An ID was not defined. Check custom UID Callback.");return e}default:throw new Error("Unknown UID Method: "+this.uidMethod)}}static setDefault(e,t){_e[e]=t}static setDefaultDB(e){de=e}get _db(){return this._localDB||de}_validate_id(e){return!(this.uidMethod===g.SLUGID&&!function(e){return d(e)&&e.length&&e.length>=20}(e))&&!(-1===e||!e)}_define_user(){GenericStore.defaultUserId&&(this.definedProps.uid=GenericStore.defaultUserId)}static get defaultUserId(){return fe.userId}get defaultUserId(){return fe.userId}static set defaultUserId(e){l("store","settings default user id to: uid =",e),ce.set(fe,"userId",e)}static resetState(){l("store","reset state"),ce.set(fe,"userId",null)}get path(){"uid"in this.definedProps||this._define_user();let e=w(this.templatePath,this.definedProps),t=E(e);if(t.length>0)throw new Error("Not all template id's are defined. Required fields are "+t.join(", "));return e.replace(/\*/g,"{id}")}previewPath(e){"uid"in this.definedProps||this._define_user();let t=w(this.templatePath,this.definedProps);return t=e?t.replace(/\*/g,e):t.replace(/\*/,"{id}"),t}childRef(e){return this._db.ref(this.path.replace(/\{id\}/g,e))}get parentRef(){return this._db.ref(this.path.split("{id}").shift())}get rootRef(){return this._db.ref()}define(e,t){e.definedProps=Object.assign({},this.definedProps,t);let i=[].concat(this._template_path_field_names,this.additionalProps);for(var r in t)i.includes(r)||a("store/define-unknown-prop","Prop",r,"not found in template path. Known fields are",i);return e}with(e){let t=this._clone();return this.define(t,e)}get _template_path_field_names(){return E(this.templatePath)}reset(e=1){1===e&&c("store","resetting",this.name,"with",this._clones.length,"clones"),this.definedProps={},e>3?a("store/reset-max-depth-reached","RESET - Stop at recursion level 3",this._clones):this._clones.forEach(t=>{t.reset(e+1)})}get schemaFields(){let e=((this.modelDefinition||{}).schema||{}).fields;return void 0===e?[]:(Array.isArray(e)||(e=Object.keys(e).map(t=>({model:t,...e[t]}))),e)}get schemaRequiredFields(){return this.schemaFields.filter(e=>e.required).map(e=>e.model)}get schemaOptionalFields(){return this.schemaFields.filter(e=>!e.required).map(e=>e.model)}get schemaAllFields(){return this.schemaFields.map(e=>e.model)}_check_required_fields(e){this.schemaRequiredFields.forEach(t=>{if(!(t in e))throw new Error("Required field <"+t+"> not present.")})}_check_required_create_arg(e){(((this.modelDefinition||{}).schema||{}).create_required||[]).forEach(t=>{if(!(t in e))throw new Error("Required create argument <"+t+"> not present.")})}_validate_schema(e,t){if(this.modelDefinition&&this.modelDefinition.schema&&this.modelDefinition.schema.unsafe_disable_validation)return;let i=this.schemaFields;if(!(this.allowEmptySchema||i&&0!==i.length))throw new Error('No schema found for "'+this.name+'", please provide one.');t||this._check_required_fields(e);const r=/Map\s*<(\w+),\s*(\w+)>/i,n=/(\w+)\s*\[\]/;let s=this.schemaAllFields,o=[],l={};0===i.length?a("model/empty-schema",'Schema for "'+this.name+'" is empty.'):(l=Object.assign(...s.map((e,t)=>(e.startsWith("/")&&e.endsWith("/")&&o.push(e),{[e]:this.schemaFields[t]}))),Object.keys(l).forEach((e,t)=>{let i=l[e].type||"";if(r.test(i)){let i="/^"+e+"\\/((?![\\/\\[\\]\\.\\#\\$\\/\\u0000-\\u001F\\u007F]).)*$/";o.push(i),l[i]=this.schemaFields[t]}})),Object.keys(e).forEach(t=>{let i=o.find(e=>{const i=e.includes("\\u00")?"":"u";return new RegExp(e.substring(1,e.length-1),i).test(t)});if(!i&&!s.includes(t))throw new Error("Field <"+t+"> is not allowed by schema.");let a=l[i||t];if(a.validator){let i=a.validator(e[t],a,null);if(!i||i.length&&0===i.length)throw new Error('User-defined schema validation failed for key "'+t+'" with error: '+i)}if(this.enableTypeValidation){if(!(a.type||"").split("|").some(i=>{let s=i.trim(),o={};if(n.test(s)){o={val:n.exec(s)[1]},s="Array"}if(r.test(s)){let e=r.exec(s);o={key:e[1],val:e[2]},s="Map"}return!a.required&&null===e[t]||this._validate_bolt_type(e[t],s,o)}))throw new Error('Type-based schema validation failed for key "'+t+'" with error.')}})}_validate_bolt_type(e,t,i={}){switch(t.toLowerCase()){case"string":return d(e);case"number":return u(e);case"boolean":return!0===(r=e)||!1===r;case"object":return h(e)&&f(e)&&!m(e);case"any":return h(e);case"null":return null===e;case"map":return f(e)&&!m(e)&&Object.entries(e).every(([e,t])=>{let r=d(e),n=this._validate_bolt_type(t,i.val);return r&&n});case"array":{let t=[];if(m(e))t=e;else{if(!f(e))return!1;t=Object.values(e)}return t.every(e=>this._validate_bolt_type(e,i.val))}default:return a("model/unknown-validation-type","Can not validate type '"+t+"'"),!0}var r}static _set_caller(e){if(!0!==e._isVue)return!1;ue=e}get _last_caller(){return ue}get rules(){let e=this.modelDefinition.schema.fields;Array.isArray(e)||(e=Object.keys(e).map(t=>({model:t,...e[t]})));let t={};return e.forEach(e=>{t[e.model]=[{validator:(t,i,r)=>{e.validator(i)?r():r(new Error("Invalid input"))},trigger:"blur"}]}),t}}var pe={strict:!0,state:{initialized:!1,res:{},sync:{},ready:{}},getters:{get_registry_entry:e=>t=>e.sync[t],is_ready:e=>t=>e.ready[t]||!1},mutations:{...{"heliosrx/INIT_VALUE":(e,{path:t,data:i})=>(c("registry","[HELIOSRX_INIT_VALUE]",{path:t,data:i}),U(e,t,i)),"heliosrx/UNSET_VALUE":(e,{path:t})=>(c("registry","[HELIOSRX_UNSET_VALUE]",{path:t}),U(e,t,{".value":null})),"heliosrx/ARRAY_ADD"(e,{target:t,newId:i,data:r}){c("registry","[HELIOSRX_ARRAY_ADD]",{target:t,newId:i,data:r}),S.set(t,i,r)},"heliosrx/ARRAY_REMOVE"(e,{target:t,oldId:i}){c("registry","[HELIOSRX_ARRAY_REMOVE]",{target:t,oldId:i}),S.delete(t,i)},"heliosrx/ARRAY_SET"(e,{target:t,currentId:i,data:r,performMerge:n=!1}){t[i]?G(t[i],r,!n):t[i]=r},"heliosrx/SET"(e,{target:t,data:i,performMerge:r=!1}){c("registry","[HELIOSRX_SET]",{target:t,data:i,performMerge:r}),G(t,i,!r)}},INIT_REGISTRY(e){e.initialized=!0},RESET_REGISTRY(e){c("registry","RESET_REGISTRY"),S.set(e,"sync",{}),S.set(e,"res",{}),S.set(e,"ready",{}),e.initialized=!1},ADD_ENTRY(e,{name:t,data:i}){c("registry","ADD_ENTRY"),e.sync[t]&&e.sync[t]===i||S.set(e.sync,t,i)},SET_ENTRY_STATUS(e,{name:t,value:i}){c("registry","SET_ENTRY_STATUS"),e.sync[t][status]&&e.sync[t][status]===i||S.set(e.sync[t],"status",i)},SET_GLOBAL_READY_STATE(e,{name:t,value:i}){c("registry","SET_GLOBAL_READY_STATE"),e.ready[t]&&e.ready[t]===!!i||S.set(e.ready,t,!!i)},REM_GLOBAL_READY_STATE(e,{name:t}){c("registry","REM_GLOBAL_READY_STATE"),S.delete(e.ready,t)}}};function ye(e){return pe.name=e,pe.namespaced=!0,pe}let be;function ge(e){GenericStore.setDefaultDB(e)}function ve(e){if(null!==GenericStore.defaultUserId)throw new Error("Call resetGenericStores before setting the default user id");GenericStore.defaultUserId=e}function we(e=!0){GenericStore.resetState();const t=N;for(var i in t){let r=t[i],n=r.subscriptions;r.reset(),e&&n&&Object.keys(n).forEach(e=>{let t=n[e];l("common","Calling unsubscribe for",i,":",e),t()})}}const Ee="0.2.4";class heliosRX{static install(){}static setup(e){return function(e){const t=e.firebaseAdmin,i=e.Vue||S,r=e.Vuex||I,n="true"===process.env.FUNCTIONS_EMULATOR;if(e.runAsUser)n?(l("common","[initializeApp]","with default config",process.env.FIREBASE_CONFIG),t.initializeApp({credential:t.credential.applicationDefault()})):t.initializeApp();else{const i=e.firebaseConfig;l("common","[initializeApp]","config",i),t.initializeApp(i)}let s=t.database();if(ge(s),j({Vue:i,models:e.models,db:s}),me({Vue:i,firebase:t}),i&&r){i.use(r);let e=new r.Store(ye("heliosRX"));j({Vuex:r,registry:e}),e.commit("INIT_REGISTRY")}}(e),heliosRX}}heliosRX.install=function e(t,i){if(e.installed&&be===t)return;if(e.installed=!0,l("common","Installing Generic API plugin"),!i)throw new Error('heliosRX: Missing configuration. Did you supply config with Vue.use("heliosRx", {...})?');if(!i.db)throw new Error('heliosRX: Missing configuration "db".');if(!i.models)throw new Error('heliosRX: Missing configuration "models".');be=t,j({Vue:t,models:i.models,db:i.db});let r,s=i.db;if(me({Vue:t,firebase:i.firebase||i.db.app.firebase_}),!s.app||!s.app.database)throw"object"==typeof s?new Error("heliosRX: Multi-DB configuration not implemented yet."):new Error("heliosRX: Invalid configuration for db.");if(GenericStore.setDefaultDB(i.db),i.useExistingStore){const e=i.useExistingStore;throw e.registerModule("heliosrx",ye("heliosRX")),j({Vuex:I,registry:e}),new Error("heliosRX: Custom state management not fully implemented.")}(t._installedPlugins||[]).forEach(e=>{e.Store&&e.mapActions&&a("common/common","Existing Vuex detected. Consider using 'useExistingStore'. See heliosRX documentation.")}),t.use(I),r=new I.Store(ye("heliosRX")),j({Vuex:I,registry:r}),r.commit("INIT_REGISTRY"),Object.defineProperty(t.prototype,"$models",{get(){return GenericStore._set_caller(this),i.models}});let o={};i.userApi&&(o=i.userApi),Object.defineProperty(t.prototype,"$api",{get:()=>o}),i.devMode?(n.setDefaultLevel("info"),n.setLevel("info"),n.getLogger("store-write").setLevel("trace")):(n.setDefaultLevel("warn"),n.setLevel("warn"));let c="false"===process.env.VUE_APP_PRODUCTION&&process.browser;(!0===i.devMode||void 0===i.devMode&&c)&&(window.$models=i.models,window.$db=i.db,window.$api=o,window.$registry=r)},heliosRX.getRegistry=T,heliosRX.GenericStore=GenericStore,heliosRX.version="0.2.4",n.channels=s;export default heliosRX;export{v as DeleteMode,GenericStore,g as UIDMethod,T as getRegistry,n as heliosLogger,p as moment,ye as registryModule,we as resetGenericStores,ge as setDefaultDB,ve as setDefaultUser,Ee as version};